<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Color Guessing Game</title>
<style>
    body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #0d0d0d, #1a1a1a);
        color: #eee;
        margin: 0;
        padding: 40px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }

    #gameContainer {
        width: 95%;
        max-width: 750px;
        background: #181818;
        padding: 35px;
        border-radius: 16px;
        box-shadow: 0 0 25px rgba(0,0,0,0.6);
        text-align: center;
        border: 1px solid #333;
    }

    h1 {
        font-size: 36px;
        margin-bottom: 10px;
        font-weight: 700;
    }

    #colorInput {
        width: 90%;
        padding: 16px;
        font-size: 20px;
        border-radius: 10px;
        border: 1px solid #333;
        background: #101010;
        color: white;
        margin-bottom: 12px;
        transition: 0.2s;
    }
    #colorInput:focus {
        border-color: #ff9d00;
        box-shadow: 0 0 8px #ff9d00;
    }

    #suggestions {
        background: #141414;
        border-radius: 10px;
        max-height: 220px;
        overflow-y: auto;
        width: 90%;
        margin: 0 auto 15px auto;
        text-align: left;
        display: none;
        padding: 6px 0;
        border: 1px solid #333;
    }

    .suggestItem {
        padding: 10px 14px;
        cursor: pointer;
        font-size: 18px;
    }
    .suggestItem:hover {
        background: #222;
    }

    button {
        padding: 14px 24px;
        margin: 6px;
        font-size: 18px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        background: #242424;
        color: white;
        transition: 0.2s;
    }
    button:hover {
        background: #333;
    }

    #guessCount {
        margin-top: 14px;
        font-size: 22px;
        color: #ff9d00;
        font-weight: 600;
    }

    #results {
        margin-top: 30px;
        font-size: 20px;
        min-height: 40px;
    }

    #preview {
        width: 90%;
        height: 70px;
        margin: 15px auto;
        background: #000;
        border-radius: 12px;
        border: 1px solid #333;
    }
</style>
</head>
<body>

<div id="gameContainer">
    <h1>Color Guessing Game</h1>

    <input id="colorInput" placeholder="Enter a color name or #hexâ€¦" autocomplete="off" />
    <div id="suggestions"></div>

    <div id="preview"></div>

    <button onclick="submitGuess()">Guess</button>
    <button onclick="giveUp()">Give Up</button>
    <button onclick="newColor()">Refresh</button>

    <div id="guessCount">Total Guesses: 0</div>
    <div id="results"></div>
</div>

<script>
let COLOR_DB = {};
let secretName = "";
let secretHex = "";
let guessCount = 0;
let guessed = new Set();

// Load the 20k color database
fetch("colors-20k.json")
    .then(r => r.json())
    .then(data => {
        COLOR_DB = data;
        newColor();
    });

function hexToRgb(hex) {
    hex = hex.replace('#', '');
    return {
        r: parseInt(hex.substring(0,2), 16),
        g: parseInt(hex.substring(2,4), 16),
        b: parseInt(hex.substring(4,6), 16)
    };
}

function colorDistance(h1, h2) {
    let c1 = hexToRgb(h1);
    let c2 = hexToRgb(h2);
    let d = Math.sqrt(
        (c1.r - c2.r)**2 +
        (c1.g - c2.g)**2 +
        (c1.b - c2.b)**2
    );
    return Math.max(0, 100 - (d / 441) * 100);
}

function newColor() {
    let names = Object.keys(COLOR_DB);
    if (names.length === 0) return;

    secretName = names[Math.floor(Math.random() * names.length)];
    secretHex = COLOR_DB[secretName];

    guessCount = 0;
    guessed.clear();

    document.getElementById("results").textContent = "";
    document.getElementById("guessCount").textContent = "Total Guesses: 0";
    document.getElementById("preview").style.background = "#000";
}

function parseColor(str) {
    str = str.trim().toLowerCase();

    if (str.startsWith("#")) {
        let hex = str.slice(1);
        if (hex.length === 3) return "#" + hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];
        if (hex.length === 6) return "#" + hex;
        return null;
    }
    return COLOR_DB[str] || null;
}

function submitGuess() {
    let val = document.getElementById("colorInput").value.trim().toLowerCase();
    if (!val) return;
    if (guessed.has(val)) return;

    guessed.add(val);
    let parsed = parseColor(val);

    if (!parsed) {
        document.getElementById("results").textContent = "Invalid color name.";
        return;
    }

    document.getElementById("preview").style.background = parsed;

    guessCount++;
    document.getElementById("guessCount").textContent = "Total Guesses: " + guessCount;

    let percent = colorDistance(parsed, secretHex).toFixed(1);

    if (percent == 100) {
        document.getElementById("results").textContent = `ðŸŽ‰ Correct! ${secretName} (${secretHex})`;
    } else {
        document.getElementById("results").textContent = `${val} â†’ ${percent}% close.`;
    }
}

function giveUp() {
    document.getElementById("results").textContent = `Secret was: ${secretName} (${secretHex})`;
    document.getElementById("preview").style.background = secretHex;
}
</script>
</body>
</html>
