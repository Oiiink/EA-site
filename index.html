<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Grow a Garden üåª with Pests, Events & Pets</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #8bc34a;
    margin: 0;
    padding: 20px;
    user-select: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background 1s;
  }
  h1 {
    color: #3e621f;
    margin-bottom: 5px;
  }
  #status {
    color: #2e4a11;
    margin-bottom: 15px;
    font-size: 18px;
    display: flex;
    gap: 24px;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
  }
  #status > div {
    font-weight: bold;
    user-select: none;
  }
  #inventory {
    margin-bottom: 20px;
    color: #2e4a11;
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
  }
  button {
    padding: 8px 14px;
    background: #33691e;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s;
  }
  button:disabled {
    background: #9ccc65;
    cursor: default;
  }
  #farmGrid {
    display: grid;
    grid-template-columns: repeat(5, 80px);
    grid-template-rows: repeat(3, 80px);
    gap: 12px;
  }
  .plot {
    width: 80px;
    height: 80px;
    background: #6d4c41;
    border-radius: 10px;
    box-shadow: inset 0 0 5px #3e2723;
    position: relative;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .plot.planted {
    background: #3e7d16;
  }
  .progressBar {
    position: absolute;
    bottom: 6px;
    left: 6px;
    right: 6px;
    height: 12px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    overflow: hidden;
  }
  .progressFill {
    height: 100%;
    background: #fbc02d;
    width: 0%;
    border-radius: 6px;
    transition: width 0.2s linear;
  }
  .cropIcon {
    font-size: 30px;
    pointer-events: none;
    user-select: none;
  }
  #upgrades {
    margin-top: 20px;
    max-width: 460px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
  }
  .upgradeBtn {
    flex: 1 1 45%;
    background: #33691e;
  }
  #dayNightCycle {
    margin-top: 20px;
    font-weight: bold;
    color: #2e4a11;
  }
  .pestIcon {
    position: absolute;
    top: 4px;
    left: 4px;
    font-size: 24px;
    pointer-events: none;
    user-select: none;
    animation: pestShake 1.5s infinite ease-in-out;
  }
  @keyframes pestShake {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(3px); }
  }
  #petsUI {
    margin-top: 20px;
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .pet {
    background: #558b2f;
    border-radius: 12px;
    padding: 10px 14px;
    cursor: pointer;
    user-select: none;
    color: white;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: background 0.3s;
  }
  .pet:hover {
    background: #33691e;
  }
  .pet-icon {
    font-size: 24px;
  }
  #eventMessage {
    margin-top: 15px;
    font-weight: bold;
    color: #2e4a11;
    min-height: 24px;
    text-align: center;
  }
</style>
</head>
<body>

<h1>Grow a Garden üåª with Pests, Events & Pets</h1>

<div id="status">
  <div>Gold: <span id="gold">20</span></div>
  <div>Seeds: <span id="seedCount">5</span></div>
  <div>Fertilizer: <span id="fertilizerCount">0</span></div>
</div>

<div id="inventory">
  <button id="buySeedBtn">Buy Seed (5 Gold)</button>
  <button id="buyFertilizerBtn">Buy Fertilizer (10 Gold)</button>
</div>

<div id="farmGrid"></div>

<div id="upgrades">
  <button class="upgradeBtn" id="upgradeSeedCostBtn">Upgrade Seed Cost (-10%) - 50 Gold</button>
  <button class="upgradeBtn" id="upgradeSellPriceBtn">Upgrade Sell Price (+10%) - 50 Gold</button>
</div>

<div id="dayNightCycle">Day Time</div>
<div id="eventMessage"></div>

<div id="petsUI">
  <div class="pet" id="petButterfly" title="Butterfly: Speeds growth by 10%">
    <span class="pet-icon">ü¶ã</span> Butterfly - 100 Gold
  </div>
  <div class="pet" id="petLadybug" title="Ladybug: Removes pests automatically">
    <span class="pet-icon">üêû</span> Ladybug - 150 Gold
  </div>
  <div class="pet" id="petBird" title="Bird: Increases harvest gold by 15%">
    <span class="pet-icon">üê¶</span> Bird - 200 Gold
  </div>
</div>

<script>
(() => {
  const ROWS = 3;
  const COLS = 5;

  // Game state variables
  let gold = 20;
  let seeds = 5;
  let fertilizer = 0;

  // Upgrades state
  let seedCostMultiplier = 1.0; // reduces seed cost
  let sellPriceMultiplier = 1.0; // increases sell price

  // Day/Night cycle
  let isDay = true;
  const DAY_DURATION = 30000; // 30 seconds day, 30 seconds night

  // Event variables
  let currentEvent = null; // "rain", "drought", "bonus", null
  let eventTimeout = null;

  // Pets state and bonuses
  const pets = {
    butterfly: { owned: false, cost: 100, growthSpeedBonus: 0.1 },
    ladybug: { owned: false, cost: 150 },
    bird: { owned: false, cost: 200, sellBonus: 0.15 }
  };

  // DOM Elements
  const goldEl = document.getElementById('gold');
  const seedCountEl = document.getElementById('seedCount');
  const fertilizerCountEl = document.getElementById('fertilizerCount');
  const buySeedBtn = document.getElementById('buySeedBtn');
  const buyFertilizerBtn = document.getElementById('buyFertilizerBtn');
  const farmGrid = document.getElementById('farmGrid');
  const upgradeSeedCostBtn = document.getElementById('upgradeSeedCostBtn');
  const upgradeSellPriceBtn = document.getElementById('upgradeSellPriceBtn');
  const dayNightCycleEl = document.getElementById('dayNightCycle');
  const eventMessageEl = document.getElementById('eventMessage');

  const petButterflyBtn = document.getElementById('petButterfly');
  const petLadybugBtn = document.getElementById('petLadybug');
  const petBirdBtn = document.getElementById('petBird');

  // Crop types: added rare crops
  // Each crop: name, growTime (ms), baseSellPrice, icon, rarity (common=1, rare=2)
  const crops = [
    {name: 'Carrot', growTime: 6000, baseSellPrice: 10, icon: 'ü•ï', rarity: 1},
    {name: 'Tomato', growTime: 9000, baseSellPrice: 15, icon: 'üçÖ', rarity: 1},
    {name: 'Pumpkin', growTime: 15000, baseSellPrice: 30, icon: 'üéÉ', rarity: 1},
    {name: 'Golden Apple', growTime: 20000, baseSellPrice: 60, icon: 'üçè', rarity: 2},
    {name: 'Magic Mushroom', growTime: 25000, baseSellPrice: 80, icon: 'üçÑ', rarity: 2},
  ];

  // Plot state: planted:bool, growth:ms, cropIndex:int, watered:bool, fertilizer:bool, pest:bool, intervalId:int|null, element:HTMLElement
  const plots = [];

  // Initialize farm grid UI
  function createFarmGrid() {
    farmGrid.innerHTML = '';
    for(let i=0; i<ROWS*COLS; i++) {
      const plot = document.createElement('div');
      plot.classList.add('plot');
      plot.dataset.index = i;
      farmGrid.appendChild(plot);

      plots[i] = {
        planted: false,
        growth: 0,
        cropIndex: null,
        watered: false,
        fertilizer: false,
        pest: false,
        intervalId: null,
        element: plot,
      };

      plot.addEventListener('click', () => onPlotClick(i));
    }
  }

  // Update UI displays
  function updateUI() {
    goldEl.textContent = gold;
    seedCountEl.textContent = seeds;
    fertilizerCountEl.textContent = fertilizer;

    buySeedBtn.disabled = gold < getSeedCost();
    buyFertilizerBtn.disabled = gold < 10;

    upgradeSeedCostBtn.disabled = gold < 50;
    upgradeSellPriceBtn.disabled = gold < 50;

    petButterflyBtn.style.opacity = pets.butterfly.owned ? 0.5 : 1;
    petLadybugBtn.style.opacity = pets.ladybug.owned ? 0.5 : 1;
    petBirdBtn.style.opacity = pets.bird.owned ? 0.5 : 1;
    petButterflyBtn.disabled = pets.butterfly.owned || gold < pets.butterfly.cost;
    petLadybugBtn.disabled = pets.ladybug.owned || gold < pets.ladybug.cost;
    petBirdBtn.disabled = pets.bird.owned || gold < pets.bird.cost;
  }

  // Calculate current seed cost based on upgrades
  function getSeedCost() {
    return Math.max(1, Math.floor(5 * seedCostMultiplier));
  }

  // Calculate sell price of crop with fertilizer, upgrades and pets
  function getSellPrice(basePrice, hasFertilizer) {
    let price = basePrice * sellPriceMultiplier;
    if (hasFertilizer) price *= 1.5;
    if (pets.bird.owned) price *= 1 + pets.bird.sellBonus;
    if (currentEvent === 'bonus') price *= 1.5;
    return Math.floor(price);
  }

  // Plant seed function: weighted random crop by rarity (rarer = lower chance)
  function plantSeed(index) {
    if (plots[index].planted || seeds <= 0) return false;

    // Weighted random by rarity
    let weightedCrops = [];
    crops.forEach((crop, i) => {
      const weight = crop.rarity === 1 ? 10 : 2; // commons 10x chance vs rares
      for(let w=0; w<weight; w++) weightedCrops.push(i);
    });
    const cropIndex = weightedCrops[Math.floor(Math.random() * weightedCrops.length)];
    const crop = crops[cropIndex];

    seeds--;
    updateUI();

    const plot = plots[index];
    plot.planted = true;
    plot.growth = 0;
    plot.cropIndex = cropIndex;
    plot.watered = false;
    plot.fertilizer = false;
    plot.pest = false;

    plot.element.classList.add('planted');
    plot.element.innerHTML = '';

    // Crop icon
    const cropIcon = document.createElement('div');
    cropIcon.className = 'cropIcon';
    cropIcon.textContent = crops[cropIndex].icon;
    plot.element.appendChild(cropIcon);

    // Progress bar
    const progressBar = document.createElement('div');
    progressBar.className = 'progressBar';
    const progressFill = document.createElement('div');
    progressFill.className = 'progressFill';
    progressBar.appendChild(progressFill);
    plot.element.appendChild(progressBar);

    // Water icon if watered
    const waterIcon = document.createElement('div');
    waterIcon.style.position = 'absolute';
    waterIcon.style.top = '6px';
    waterIcon.style.right = '6px';
    waterIcon.style.fontSize = '20px';
    waterIcon.style.opacity = '0.6';
    waterIcon.textContent = '';
    plot.element.appendChild(waterIcon);

    // Fertilizer icon if fertilized
    const fertIcon = document.createElement('div');
    fertIcon.style.position = 'absolute';
    fertIcon.style.bottom = '6px';
    fertIcon.style.right = '6px';
    fertIcon.style.fontSize = '20px';
    fertIcon.style.opacity = '0.8';
    fertIcon.textContent = '';
    plot.element.appendChild(fertIcon);

    // Pest icon if pest appears
    const pestIcon = document.createElement('div');
    pestIcon.className = 'pestIcon';
    pestIcon.style.display = 'none';
    pestIcon.textContent = 'üêõ';
    plot.element.appendChild(pestIcon);

    // Growth interval
    plot.intervalId = setInterval(() => {
      if (!plot.planted) {
        clearInterval(plot.intervalId);
        plot.intervalId = null;
        return;
      }

      // Growth rate modifier
      let growthRate = 200; // ms per growth unit
      if (plot.watered) growthRate /= 2;
      if (plot.fertilizer) growthRate /= 1.5;
      if (pets.butterfly.owned) growthRate /= 1 + pets.butterfly.growthSpeedBonus;
      if (currentEvent === 'drought') growthRate *= 2; // drought slows growth
      
      // Pest effect: slows growth by 50%
      if (plot.pest) growthRate *= 1.5;

      plot.growth += 1000 / growthRate;

      // Update progress bar
      let progressPercent = Math.min(100, (plot.growth / crops[cropIndex].growTime) * 100);
      progressFill.style.width = progressPercent + '%';

      // Update icons
      waterIcon.textContent = plot.watered ? 'üíß' : '';
      fertIcon.textContent = plot.fertilizer ? 'üåø' : '';
      pestIcon.style.display = plot.pest ? 'block' : 'none';

      if (plot.growth >= crops[cropIndex].growTime) {
        plot.growth = crops[cropIndex].growTime;
        clearInterval(plot.intervalId);
        plot.intervalId = null;
        // Change crop icon to grown
        cropIcon.textContent = 'üåæ';
      }
    }, 300);
    return true;
  }

  // Harvest crop function
  function harvestCrop(index) {
    const plot = plots[index];
    if (!plot.planted) return false;
    if (plot.growth < crops[plot.cropIndex].growTime) return false;

    // Calculate sell price
    const crop = crops[plot.cropIndex];
    const sellPrice = getSellPrice(crop.baseSellPrice, plot.fertilizer);

    gold += sellPrice;
    updateUI();

    // Reset plot
    plot.planted = false;
    plot.growth = 0;
    plot.cropIndex = null;
    plot.watered = false;
    plot.fertilizer = false;
    plot.pest = false;

    plot.element.classList.remove('planted');
    plot.element.innerHTML = '';

    return true;
  }

  // Water plot function
  function waterPlot(index) {
    const plot = plots[index];
    if (!plot.planted) return false;
    plot.watered = true;
    return true;
  }

  // Apply fertilizer to plot
  function applyFertilizer(index) {
    const plot = plots[index];
    if (!plot.planted) return false;
    if (fertilizer <= 0) return false;
    if (plot.fertilizer) return false; // only one fertilizer per plot

    fertilizer--;
    plot.fertilizer = true;
    updateUI();
    return true;
  }

  // Remove pest from plot
  function removePest(index) {
    const plot = plots[index];
    if (!plot.planted || !plot.pest) return false;
    plot.pest = false;
    updateUI();
    return true;
  }

  // Handle clicking on plots:
  // If empty: plant seed if possible
  // If planted & grown: harvest
  // If planted & pest: remove pest
  // If planted & not grown & no pest: water or fertilizer (choose with prompt)
  function onPlotClick(index) {
    const plot = plots[index];

    if (!plot.planted) {
      if (seeds <= 0) {
        alert('No seeds available. Buy more seeds!');
        return;
      }
      if (!plantSeed(index)) {
        alert('Cannot plant seed here.');
      }
      return;
    }

    if (plot.pest) {
      if (!removePest(index)) alert('No pests to remove!');
      return;
    }

    if (plot.growth >= crops[plot.cropIndex].growTime) {
      harvestCrop(index);
      return;
    }

    // Not fully grown, ask watering or fertilizer
    if (fertilizer > 0 && !plot.fertilizer) {
      const choice = confirm('Apply fertilizer to speed growth? (Cancel to water instead)');
      if (choice) {
        if (!applyFertilizer(index)) alert('Cannot apply fertilizer here.');
        return;
      }
    }
    waterPlot(index);
  }

  // Buy seed
  buySeedBtn.addEventListener('click', () => {
    const cost = getSeedCost();
    if (gold >= cost) {
      gold -= cost;
      seeds++;
      updateUI();
    }
  });

  // Buy fertilizer
  buyFertilizerBtn.addEventListener('click', () => {
    if (gold >= 10) {
      gold -= 10;
      fertilizer++;
      updateUI();
    }
  });

  // Upgrades
  upgradeSeedCostBtn.addEventListener('click', () => {
    if (gold >= 50) {
      gold -= 50;
      seedCostMultiplier = Math.max(0.5, seedCostMultiplier - 0.1);
      alert('Seed cost reduced by 10%!');
      updateUI();
    }
  });
  upgradeSellPriceBtn.addEventListener('click', () => {
    if (gold >= 50) {
      gold -= 50;
      sellPriceMultiplier += 0.1;
      alert('Sell price increased by 10%!');
      updateUI();
    }
  });

  // Pets purchase handlers
  petButterflyBtn.addEventListener('click', () => {
    if (pets.butterfly.owned) {
      alert('You already own the Butterfly!');
      return;
    }
    if (gold >= pets.butterfly.cost) {
      gold -= pets.butterfly.cost;
      pets.butterfly.owned = true;
      alert('Butterfly purchased! Growth speed increased by 10%.');
      updateUI();
    }
  });
  petLadybugBtn.addEventListener('click', () => {
    if (pets.ladybug.owned) {
      alert('You already own the Ladybug!');
      return;
    }
    if (gold >= pets.ladybug.cost) {
      gold -= pets.ladybug.cost;
      pets.ladybug.owned = true;
      alert('Ladybug purchased! Pests will be removed automatically every 10 seconds.');
      updateUI();
    }
  });
  petBirdBtn.addEventListener('click', () => {
    if (pets.bird.owned) {
      alert('You already own the Bird!');
      return;
    }
    if (gold >= pets.bird.cost) {
      gold -= pets.bird.cost;
      pets.bird.owned = true;
      alert('Bird purchased! Harvest gold increased by 15%.');
      updateUI();
    }
  });

  // Day/Night cycle toggle and event triggering
  function toggleDayNight() {
    isDay = !isDay;
    if (isDay) {
      document.body.style.background = '#8bc34a';
      dayNightCycleEl.textContent = 'Day Time';
      eventMessageEl.textContent = '';
      // Reset watering status at day start
      plots.forEach(plot => {
        if (plot.planted) plot.watered = false;
      });
      // Possibly trigger random event
      tryTriggerEvent();
    } else {
      document.body.style.background = '#264d00';
      dayNightCycleEl.textContent = 'Night Time (Water plants!)';
      // Water all plants automatically at night start (simulate dew)
      plots.forEach(plot => {
        if (plot.planted) plot.watered = false;
      });
    }
  }

  // Random event system: rain, drought, bonus harvest
  function tryTriggerEvent() {
    if (currentEvent !== null) return; // one event at a time

    const roll = Math.random();
    if (roll < 0.2) {
      startEvent('rain', 15000, 'It\'s raining! All plants are watered automatically.');
    } else if (roll < 0.35) {
      startEvent('drought', 20000, 'Drought! Plant growth is slower.');
    } else if (roll < 0.45) {
      startEvent('bonus', 15000, 'Bonus harvest day! Crops sell for 50% more gold.');
    }
  }

  function startEvent(name, duration, message) {
    currentEvent = name;
    eventMessageEl.textContent = message;

    if (name === 'rain') {
      // Water all plants immediately
      plots.forEach(plot => {
        if (plot.planted) plot.watered = true;
      });
      updateUI();
    }

    eventTimeout = setTimeout(() => {
      currentEvent = null;
      eventMessageEl.textContent = '';
    }, duration);
  }

  // Pests spawning
  function spawnPests() {
    // Only spawn if no current pest on that plot
    const emptyPlots = plots.filter(p => p.planted && !p.pest && p.growth < crops[p.cropIndex].growTime);
    if (emptyPlots.length === 0) return;

    const pestChance = 0.15; // 15% chance each spawn cycle
    if (Math.random() < pestChance) {
      const chosenPlot = emptyPlots[Math.floor(Math.random() * emptyPlots.length)];
      chosenPlot.pest = true;
    }
  }

  // Ladybug pet auto remove pests every 10 seconds
  function ladybugAutoRemovePests() {
    if (!pets.ladybug.owned) return;
    plots.forEach(plot => {
      if (plot.pest) plot.pest = false;
    });
  }

  // Main intervals
  setInterval(() => {
    spawnPests();
  }, 12000);

  setInterval(() => {
    ladybugAutoRemovePests();
  }, 10000);

  setInterval(toggleDayNight, DAY_DURATION);

  // Init farm and UI
  createFarmGrid();
  updateUI();
})();
</script>

</body>
</html>
