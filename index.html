<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grow a Garden</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #e3f2d6;
      margin: 0;
      padding: 0;
    }
    header {
      background: #7bb661;
      padding: 10px;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .top-info span {
      margin-right: 20px;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      padding: 10px;
    }
    .plot {
      width: 100px;
      height: 100px;
      margin: 5px;
      background: #b3db94;
      border: 2px solid #567d46;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    .crop {
      font-weight: bold;
    }
    .timer {
      position: absolute;
      bottom: 5px;
      font-size: 12px;
      background: rgba(255,255,255,0.7);
      padding: 2px 4px;
      border-radius: 4px;
    }
    .market, .encyclopedia {
      padding: 10px;
      margin: 10px;
      background: white;
      border-radius: 8px;
      flex: 1;
      max-height: 400px;
      overflow-y: auto;
    }
    .item {
      margin: 5px 0;
    }
    button {
      padding: 5px 10px;
      margin-left: 10px;
      cursor: pointer;
    }
    .rare { color: purple; }
    .epic { color: orange; }
    .legendary { color: gold; font-weight: bold; }
  </style>
</head>
<body>
  <header>
    <div class="top-info">
      <span>üå± Gold: <span id="gold">100</span></span>
      <span>üå¶Ô∏è Season: <span id="season">Spring</span></span>
      <span>‚õÖ Weather: <span id="weather">Sunny</span></span>
    </div>
    <div>
      <span>‚è∞ Next Market: <span id="marketTimer">300</span>s</span>
      <span>‚è≥ Next Event: <span id="eventTimer">120</span>s</span>
    </div>
  </header>

  <div class="container" id="field"></div>

  <div style="display:flex; gap: 10px;">
    <div class="market">
      <h3>üõí Market</h3>
      <div id="marketList"></div>
    </div>

    <div class="encyclopedia">
      <h3>üìö Encyclopedia</h3>
      <select id="sortType">
        <option value="name">Name</option>
        <option value="rarity">Rarity</option>
        <option value="value">Value</option>
      </select>
      <div id="encyclopediaList"></div>
    </div>
  </div>

  <script>
    const crops = [
      { name: "Carrot", base: 5 },
      { name: "Potato", base: 6 },
      { name: "Tomato", base: 8 },
      { name: "Strawberry", base: 10 },
      { name: "Pumpkin", base: 15 }
    ];
    const rarities = [
      { name: "Common", chance: 0.6, class: "" },
      { name: "Uncommon", chance: 0.25, class: "rare" },
      { name: "Rare", chance: 0.1, class: "epic" },
      { name: "Legendary", chance: 0.05, class: "legendary" }
    ];
    const pets = [{ name: "Butterfly", mutationBoost: 0.1 }];
    let season = "Spring";
    let weather = "Sunny";
    let gold = 100;
    let encyclopedia = {};
    let field = [];

    const marketItems = [
      () => ({ name: "Buy Carrot Seed", action: () => plantCrop("Carrot"), cost: 5 }),
      () => ({ name: "Buy Watering Can", action: () => alert("You bought a watering can!"), cost: 15 }),
      () => ({ name: "Buy Fertilizer", action: () => { hasFertilizer = true; }, cost: 20 })
    ];
    let hasFertilizer = false;
    let marketCooldown = 300;
    let eventCooldown = 120;

    const fieldEl = document.getElementById("field");
    const marketList = document.getElementById("marketList");
    const encyclopediaList = document.getElementById("encyclopediaList");

    function createField() {
      for (let i = 0; i < 20; i++) {
        const div = document.createElement("div");
        div.className = "plot";
        div.innerText = "+";
        div.onclick = () => showCropSelection(i);
        field.push({ el: div, crop: null });
        fieldEl.appendChild(div);
      }
    }

    function showCropSelection(index) {
      const crop = crops[Math.floor(Math.random() * crops.length)];
      if (gold < 5) return alert("Not enough gold!");
      gold -= 5;
      updateGold();
      growCrop(index, crop.name);
    }

    function growCrop(index, cropName) {
      const rarity = getRarity();
      const growTime = 10 - (season === "Summer" ? 2 : 0) - (weather === "Rain" ? 2 : 0);
      const cropObj = { name: cropName, rarity, timer: growTime, full: growTime };
      field[index].crop = cropObj;
      updateField();
    }

    function getRarity() {
      let roll = Math.random();
      if (hasFertilizer) roll -= 0.15;
      if (season === "Spring") roll -= 0.1;
      if (pets.length) roll -= pets[0].mutationBoost;
      let acc = 0;
      for (let r of rarities) {
        acc += r.chance;
        if (roll <= acc) return r;
      }
      return rarities[0];
    }

    function updateField() {
      field.forEach((plot, i) => {
        const el = plot.el;
        el.innerHTML = "";
        if (plot.crop) {
          const cropEl = document.createElement("div");
          cropEl.className = `crop ${plot.crop.rarity.class}`;
          cropEl.innerText = `${plot.crop.name}`;
          const timer = document.createElement("div");
          timer.className = "timer";
          timer.innerText = `${plot.crop.timer}s`;
          el.appendChild(cropEl);
          el.appendChild(timer);
        } else {
          el.innerText = "+";
        }
      });
    }

    function updateGold() {
      document.getElementById("gold").innerText = gold;
    }

    function tick() {
      field.forEach((plot, i) => {
        if (plot.crop) {
          plot.crop.timer--;
          if (plot.crop.timer <= 0) {
            gold += plot.crop.rarity.class === "legendary" ? 50 : plot.crop.rarity.class === "epic" ? 25 : 10;
            encyclopedia[plot.crop.name] = {
              name: plot.crop.name,
              rarity: plot.crop.rarity.name,
              value: plot.crop.rarity.class === "legendary" ? 50 : 10
            };
            plot.crop = null;
            updateGold();
          }
        }
      });
      updateField();
    }

    function updateSeason() {
      const order = ["Spring", "Summer", "Fall", "Winter"];
      season = order[(order.indexOf(season) + 1) % 4];
      document.getElementById("season").innerText = season;
    }

    function updateWeather() {
      const w = ["Sunny", "Rain", "Storm", "Snow"];
      weather = w[Math.floor(Math.random() * w.length)];
      document.getElementById("weather").innerText = weather;
    }

    function updateMarket() {
      marketList.innerHTML = "";
      marketItems.forEach(gen => {
        const item = gen();
        const div = document.createElement("div");
        div.className = "item";
        div.innerText = `${item.name} ($${item.cost})`;
        const btn = document.createElement("button");
        btn.innerText = "Buy";
        btn.onclick = () => {
          if (gold >= item.cost) {
            gold -= item.cost;
            updateGold();
            item.action();
          }
        };
        div.appendChild(btn);
        marketList.appendChild(div);
      });
    }

    function updateEncyclopedia() {
      encyclopediaList.innerHTML = "";
      const sort = document.getElementById("sortType").value;
      let data = Object.values(encyclopedia);
      if (sort === "rarity") {
        data.sort((a, b) => rarities.findIndex(r => r.name === a.rarity) - rarities.findIndex(r => r.name === b.rarity));
      } else if (sort === "value") {
        data.sort((a, b) => b.value - a.value);
      } else {
        data.sort((a, b) => a.name.localeCompare(b.name));
      }
      data.forEach(c => {
        const div = document.createElement("div");
        div.innerHTML = `<span class="${rarities.find(r => r.name === c.rarity).class}">${c.name}</span> ‚Äì ${c.rarity} ‚Äì $${c.value}`;
        encyclopediaList.appendChild(div);
      });
    }

    createField();
    updateMarket();

    setInterval(() => {
      tick();
      updateEncyclopedia();
    }, 1000);

    setInterval(() => {
      updateSeason();
    }, 120000);

    setInterval(() => {
      updateWeather();
    }, 90000);

    setInterval(() => {
      updateMarket();
      marketCooldown = 300;
    }, 300000);

    setInterval(() => {
      marketCooldown--;
      document.getElementById("marketTimer").innerText = marketCooldown;
    }, 1000);

    setInterval(() => {
      eventCooldown--;
      document.getElementById("eventTimer").innerText = eventCooldown;
    }, 1000);
  </script>
</body>
</html>
