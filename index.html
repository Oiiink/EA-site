<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dating Sim - Grow a Relationship</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
  body {
    margin:0; padding:0; font-family: 'Roboto', sans-serif;
    background: #222;
    color: #eee;
    user-select:none;
    display: flex; flex-direction: column; height: 100vh;
  }
  #gameContainer {
    max-width: 700px; margin: auto; display:flex; flex-direction: column;
    height: 100vh;
    background: linear-gradient(to bottom, #2c3e50, #4ca1af);
    border-radius: 12px;
    box-shadow: 0 0 20px #0008;
    overflow: hidden;
  }
  #header {
    padding: 12px 20px;
    background: #34495e;
    font-weight: 700; font-size: 1.3em;
    text-align: center;
    user-select:none;
  }
  #avatarCustomization {
    padding: 10px 20px;
    background: #3b5367;
    display: flex; justify-content: center; gap: 20px;
    flex-wrap: wrap;
    color: #ccc;
  }
  label {cursor: pointer;}
  select, input[type=color] {
    padding: 5px;
    border-radius: 5px;
    border: none;
    font-size: 1em;
  }
  #characterSelect {
    display: flex; justify-content: center; background: #3b5367;
    padding: 10px;
    gap: 15px;
  }
  .charBtn {
    padding: 8px 16px;
    border-radius: 10px;
    background: #5588aa;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .charBtn.selected {
    background: #d48;
    color: white;
    box-shadow: 0 0 8px #f44;
  }
  #scene {
    flex-grow: 1;
    display: flex;
    background-size: cover;
    background-position: center;
    position: relative;
    padding: 10px;
    overflow: hidden;
  }
  #portrait {
    width: 180px;
    height: 320px;
    background: #222;
    border-radius: 15px;
    box-shadow: 0 0 15px #000a inset;
    flex-shrink: 0;
    margin-right: 20px;
    display: flex; flex-direction: column; align-items: center;
  }
  #portrait img {
    max-width: 100%;
    border-radius: 15px;
    user-select:none;
  }
  #portrait .nameTag {
    margin-top: 8px;
    font-weight: 700;
    font-size: 1.2em;
    color: #eee;
    text-shadow: 0 0 6px #0009;
  }
  #dialogueBox {
    flex-grow: 1;
    background: rgba(0,0,0,0.6);
    border-radius: 15px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    color: #eee;
    box-shadow: 0 0 12px #0009 inset;
  }
  #dialogueText {
    font-size: 1.1em;
    min-height: 90px;
    white-space: pre-wrap;
    user-select:none;
  }
  #choices {
    margin-top: 15px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
  }
  .choiceBtn {
    flex: 1 1 45%;
    background: #4a729d;
    border: none;
    border-radius: 10px;
    padding: 10px 15px;
    font-weight: 600;
    color: white;
    cursor: pointer;
    box-shadow: 0 3px 0 #2c4362;
    transition: background 0.3s ease;
  }
  .choiceBtn:hover {
    background: #5a8acc;
  }
  #statusBar {
    background: #34495e;
    color: #ccc;
    font-size: 0.9em;
    padding: 6px 15px;
    display: flex;
    justify-content: space-between;
    user-select:none;
  }
  #inventory {
    background: #3b5367;
    padding: 10px 20px;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    user-select:none;
  }
  .invItem {
    background: #4a729d;
    border-radius: 8px;
    padding: 5px 12px;
    cursor: pointer;
    box-shadow: 0 3px 0 #2c4362;
    font-weight: 600;
    color: white;
    user-select:none;
    transition: background 0.3s ease;
  }
  .invItem.selected {
    background: #d48;
    box-shadow: 0 0 10px #f44;
  }
  #giftArea {
    background: #3b5367;
    padding: 15px 20px;
    text-align: center;
    border-radius: 0 0 12px 12px;
    user-select:none;
  }
  #giftButtons button {
    margin: 5px 8px;
    padding: 10px 15px;
    border-radius: 10px;
    border: none;
    background: #6a9c58;
    color: white;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 3px 0 #466d39;
    transition: background 0.3s ease;
  }
  #giftButtons button:hover {
    background: #7ec76e;
  }
  #timeBar {
    height: 8px;
    background: #2c4362;
    border-radius: 5px;
    overflow: hidden;
    margin-top: 10px;
  }
  #timeProgress {
    height: 100%;
    background: #d48;
    width: 100%;
    transition: width 0.1s linear;
  }
  #messageBox {
    position: absolute;
    top: 10px; left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.7);
    padding: 10px 20px;
    border-radius: 10px;
    font-weight: 700;
    color: #f44;
    display: none;
    user-select:none;
  }
</style>
</head>
<body>
  <div id="gameContainer" role="main" aria-label="Dating simulation game">
    <header id="header">Dating Sim: Grow a Relationship</header>

    <section id="avatarCustomization" aria-label="Avatar customization">
      <label for="avatarStyle">Avatar Style:</label>
      <select id="avatarStyle" aria-describedby="avatarStyleDesc">
        <option value="style1">Style 1</option>
        <option value="style2">Style 2</option>
      </select>
      <span id="avatarStyleDesc" class="sr-only">Choose your avatar style</span>
      <label for="avatarColor">Avatar Color:</label>
      <input type="color" id="avatarColor" value="#f48fb1" aria-label="Select avatar color" />
      <button id="startGameBtn" aria-label="Start Game Button">Start Game</button>
    </section>

    <section id="characterSelect" aria-label="Select character to talk to" style="display:none;">
      <button class="charBtn selected" data-char="lily" aria-pressed="true" aria-label="Talk to Lily">Lily</button>
      <button class="charBtn" data-char="mia" aria-pressed="false" aria-label="Talk to Mia">Mia</button>
    </section>

    <section id="scene" aria-live="polite" aria-atomic="true" aria-relevant="additions removals" style="background-image:url('https://i.ibb.co/3rWspNP/park-bg.jpg');">
      <div id="portrait" aria-label="Character portrait" role="img" aria-live="polite">
        <img src="" alt="Character portrait" id="portraitImg" />
        <div class="nameTag" id="portraitName"></div>
      </div>

      <article id="dialogueBox" role="region" aria-label="Dialogue">
        <div id="dialogueText" aria-live="assertive" aria-atomic="true"></div>
        <div id="timeBar" aria-hidden="true"><div id="timeProgress"></div></div>
        <div id="choices" role="list"></div>
      </article>
    </section>

    <section id="inventory" aria-label="Inventory" style="display:none;">
      <div id="inventorySeedsLabel">Seeds:</div>
      <div id="inventorySeeds" role="list" aria-label="Seed inventory"></div>
      <div id="inventoryGiftsLabel">Gifts:</div>
      <div id="inventoryGifts" role="list" aria-label="Gift inventory"></div>
    </section>

    <section id="giftArea" aria-label="Gift giving area" style="display:none;">
      <div id="giftButtons">
        <button data-gift="flower" aria-label="Give Flower">üå∏ Flower</button>
        <button data-gift="chocolate" aria-label="Give Chocolate">üç´ Chocolate</button>
      </div>
    </section>

    <section id="statusBar" aria-label="Game status">
      <div id="dayCounter">Day: 1</div>
      <div id="timeOfDay">Time: Morning</div>
      <div id="relationshipStatus">Relationship: 0</div>
    </section>

    <div id="messageBox" role="alert" aria-live="assertive"></div>
  </div>

<script>
(() => {
  // === Game State ===
  let playerName = "You";
  let avatarStyle = "style1";
  let avatarColor = "#f48fb1";
  let currentCharacter = "lily";
  let currentNodeKey = null;
  let relationship = { lily: 0, mia: 0 };
  let moods = { lily: 0, mia: 0 }; // 0 calm, 1 happy, 2 annoyed, 3 angry
  let questionMemory = { lily: {}, mia: {} };
  let inventory = {
    seeds: { carrot: 2, strawberry: 1 },
    gifts: { flower: 1, chocolate: 1 }
  };
  let day = 1;
  let timeOfDayIndex = 0; // 0: Morning, 1: Afternoon, 2: Evening, 3: Night
  const timesOfDay = ["Morning", "Afternoon", "Evening", "Night"];
  let timerInterval = null;
  let timeLimit = 30; // seconds to answer
  let timeLeft = timeLimit;
  let timerActive = false;

  const scenes = {
    park: "https://i.ibb.co/3rWspNP/park-bg.jpg",
    cafe: "https://i.ibb.co/v4gPTnt/cafe-bg.jpg",
    street: "https://i.ibb.co/b7f4kxy/street-bg.jpg",
    home: "https://i.ibb.co/1Xw0h17/home-bg.jpg"
  };

  // Simple avatars placeholders (circle + eyes + mouth, tinted)
  const avatars = {
    style1: {
      calm: "https://i.ibb.co/4PT9ZbG/face-calm.png",
      happy: "https://i.ibb.co/qJ1QqL2/face-happy.png",
      annoyed: "https://i.ibb.co/MV7BkRR/face-annoyed.png",
      angry: "https://i.ibb.co/bBK5fYw/face-angry.png"
    },
    style2: {
      calm: "https://i.ibb.co/j8GmRRk/face2-calm.png",
      happy: "https://i.ibb.co/7kpPL3P/face2-happy.png",
      annoyed: "https://i.ibb.co/r22fLBS/face2-annoyed.png",
      angry: "https://i.ibb.co/NKV7LmC/face2-angry.png"
    }
  };

  const characters = {
    lily: {
      name: "Lily",
      location: "park",
      personality: "sweet and shy",
      basePortrait: avatars[avatarStyle].calm,
      expressions: ["calm","happy","annoyed","angry"],
      dialogue: {
        start: {
          text: () => `Hi ${playerName}, nice to see you! What would you like to say?`,
          options: [
            { text: "How are you today?", next: "howAreYou", questionId: "howAreYou" },
            { text: "Tell me about yourself.", next: "about", questionId: "about" },
            { text: "Give a gift", next: "giveGift" },
            { text: "Say goodbye", next: "bye" }
          ],
          timed: 0
        },
        howAreYou: {
          text: (memCount) => {
            if(memCount>1) return `"You keep asking the same thing... Please stop." Lily looks annoyed.`;
            return `"I'm doing well, thank you for asking!"`;
          },
          options: [
            { text: "That's good!", next: "start" },
            { text: "Want to hang out later?", next: "hangout", questionId: "hangout" }
          ],
          timed: 10
        },
        about: {
          text: `"I'm a bit shy but I love gardening and cute animals."`,
          options: [
            { text: "That's adorable!", next: "start" },
            { text: "Give a gift", next: "giveGift" }
          ],
          timed: 0
        },
        hangout: {
          text: `"I'd love that! Meet me at the park this afternoon."`,
          options: [
            { text: "See you then!", next: "start" }
          ],
          timed: 0
        },
        giveGift: {
          text: "Which gift would you like to give?",
          options: [
            { text: "Flower üå∏", next: "giftFlower" },
            { text: "Chocolate üç´", next: "giftChocolate" },
            { text: "Nevermind", next: "start" }
          ],
          timed: 0
        },
        giftFlower: {
          text: `"Oh, a flower? That's so sweet! Thank you!"`,
          options: [
            { text: "You're welcome!", next: "start" }
          ],
          effect: () => { 
            relationship.lily += 3; 
            moods.lily = Math.max(0, moods.lily - 1);
            inventory.gifts.flower = Math.max(0, inventory.gifts.flower-1);
            showMessage("You gave Lily a flower. Relationship increased!");
          },
          timed: 0
        },
        giftChocolate: {
          text: `"Chocolate! You really know how to make me smile!"`,
          options: [
            { text: "Glad you like it!", next: "start" }
          ],
          effect: () => {
            relationship.lily += 5;
            moods.lily = Math.max(0, moods.lily - 2);
            inventory.gifts.chocolate = Math.max(0, inventory.gifts.chocolate-1);
            showMessage("You gave Lily chocolate. Relationship increased!");
          },
          timed: 0
        },
        bye: {
          text: `"Bye! Hope to talk again soon."`,
          options: [
            { text: "Talk again", next: "start" }
          ],
          timed: 0
        }
      }
    },
    mia: {
      name: "Mia",
      location: "cafe",
      personality: "smart and mysterious",
      basePortrait: avatars[avatarStyle].calm,
      expressions: ["calm","happy","annoyed","angry"],
      dialogue: {
        start: {
          text: () => `Hey ${playerName}, what‚Äôs up?`,
          options: [
            { text: "What are you reading?", next: "reading", questionId: "reading" },
            { text: "Want to grab coffee?", next: "coffee", questionId: "coffee" },
            { text: "Give a gift", next: "giveGift" },
            { text: "Say goodbye", next: "bye" }
          ],
          timed: 0
        },
        reading: {
          text: (memCount) => {
            if(memCount > 1) return `"You asked me that before... Please stop." Mia looks annoyed.`;
            return `"It‚Äôs a mystery novel. I love puzzles."`;
          },
          options: [
            { text: "Sounds fun!", next: "start" },
            { text: "Let‚Äôs solve one together!", next: "puzzle", questionId: "puzzle" }
          ],
          timed: 10
        },
        coffee: {
          text: `"I‚Äôd love to! Let‚Äôs go."`,
          options: [
            { text: "Lead the way.", next: "start" }
          ],
          timed: 0
        },
        giveGift: {
          text: "Which gift would you like to give?",
          options: [
            { text: "Flower üå∏", next: "giftFlower" },
            { text: "Chocolate üç´", next: "giftChocolate" },
            { text: "Nevermind", next: "start" }
          ],
          timed: 0
        },
        giftFlower: {
          text: `"A flower? How thoughtful, thanks!"`,
          options: [
            { text: "You're welcome!", next: "start" }
          ],
          effect: () => { 
            relationship.mia += 3; 
            moods.mia = Math.max(0, moods.mia - 1);
            inventory.gifts.flower = Math.max(0, inventory.gifts.flower-1);
            showMessage("You gave Mia a flower. Relationship increased!");
          },
          timed: 0
        },
        giftChocolate: {
          text: `"Chocolate? You spoil me! Thanks!"`,
          options: [
            { text: "Glad you like it!", next: "start" }
          ],
          effect: () => {
            relationship.mia += 5;
            moods.mia = Math.max(0, moods.mia - 2);
            inventory.gifts.chocolate = Math.max(0, inventory.gifts.chocolate-1);
            showMessage("You gave Mia chocolate. Relationship increased!");
          },
          timed: 0
        },
        puzzle: {
          text: "Solve this puzzle to impress Mia:\nWhat has keys but can't open locks?",
          options: [
            { text: "A piano", next: "puzzleCorrect" },
            { text: "A map", next: "puzzleWrong" },
            { text: "I don‚Äôt know", next: "puzzleWrong" }
          ],
          timed: 20
        },
        puzzleCorrect: {
          text: `"Correct! You're really smart."`,
          options: [
            { text: "Thanks!", next: "start" }
          ],
          effect: () => {
            relationship.mia += 7;
            moods.mia = 1;
            showMessage("You impressed Mia with your wit!");
          }
        },
        puzzleWrong: {
          text: `"Not quite... Maybe next time."`,
          options: [
            { text: "I'll try harder!", next: "start" }
          ],
          effect: () => {
            relationship.mia = Math.max(0, relationship.mia - 2);
            moods.mia = 2;
            showMessage("Mia seems a bit disappointed.");
          }
        },
        bye: {
          text: `"Bye! Catch you later."`,
          options: [
            { text: "Talk again", next: "start" }
          ],
          timed: 0
        }
      }
    }
  };

  // === Elements ===
  const portraitImg = document.getElementById('portraitImg');
  const portraitName = document.getElementById('portraitName');
  const dialogueText = document.getElementById('dialogueText');
  const choicesDiv = document.getElementById('choices');
  const dayCounter = document.getElementById('dayCounter');
  const timeOfDayLabel = document.getElementById('timeOfDay');
  const relationshipStatus = document.getElementById('relationshipStatus');
  const messageBox = document.getElementById('messageBox');
  const sceneEl = document.getElementById('scene');
  const avatarStyleSelect = document.getElementById('avatarStyle');
  const avatarColorInput = document.getElementById('avatarColor');
  const startGameBtn = document.getElementById('startGameBtn');
  const charButtons = document.querySelectorAll('.charBtn');
  const characterSelect = document.getElementById('characterSelect');
  const inventorySeeds = document.getElementById('inventorySeeds');
  const inventoryGifts = document.getElementById('inventoryGifts');
  const inventorySection = document.getElementById('inventory');
  const giftArea = document.getElementById('giftArea');
  const giftButtons = document.querySelectorAll('#giftButtons button');
  const avatarCustomization = document.getElementById('avatarCustomization');

  // Accessibility helper: hide visually but keep for screen readers
  const srOnlyCSS = document.createElement('style');
  srOnlyCSS.innerHTML = `.sr-only {position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0;}`;
  document.head.appendChild(srOnlyCSS);

  // === Helpers ===
  function saveGame() {
    const saveData = {
      relationship, moods, inventory, day, timeOfDayIndex, currentCharacter, currentNodeKey,
      avatarStyle, avatarColor, questionMemory,
    };
    localStorage.setItem('datingSimSave', JSON.stringify(saveData));
  }
  function loadGame() {
    const data = localStorage.getItem('datingSimSave');
    if (!data) return false;
    try {
      const saveData = JSON.parse(data);
      Object.assign(relationship, saveData.relationship);
      Object.assign(moods, saveData.moods);
      Object.assign(inventory, saveData.inventory);
      day = saveData.day;
      timeOfDayIndex = saveData.timeOfDayIndex;
      currentCharacter = saveData.currentCharacter || 'lily';
      currentNodeKey = saveData.currentNodeKey || null;
      avatarStyle = saveData.avatarStyle || 'style1';
      avatarColor = saveData.avatarColor || '#f48fb1';
      Object.assign(questionMemory, saveData.questionMemory || { lily: {}, mia: {} });
      return true;
    } catch {
      return false;
    }
  }
  function showMessage(msg, duration = 4000) {
    messageBox.textContent = msg;
    messageBox.style.display = 'block';
    setTimeout(() => { messageBox.style.display = 'none'; }, duration);
  }
  function updateAvatar() {
    const char = characters[currentCharacter];
    const mood = moods[currentCharacter];
    const moodKey = ['calm','happy','annoyed','angry'][mood] || 'calm';
    const avatarImgUrl = avatars[avatarStyle][moodKey];
    portraitImg.src = avatarImgUrl;
    portraitImg.style.filter = `drop-shadow(0 0 8px ${avatarColor})`;
    portraitName.textContent = char.name;
  }
  function updateBackground() {
    const loc = characters[currentCharacter].location;
    sceneEl.style.backgroundImage = `url('${scenes[loc]}')`;
  }
  function updateStatus() {
    dayCounter.textContent = `Day: ${day}`;
    timeOfDayLabel.textContent = `Time: ${timesOfDay[timeOfDayIndex]}`;
    const rel = relationship[currentCharacter];
    relationshipStatus.textContent = `Relationship: ${rel}`;
  }
  function clearChoices() {
    choicesDiv.innerHTML = '';
  }
  function setChoices(options) {
    clearChoices();
    options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.className = 'choiceBtn';
      btn.textContent = opt.text;
      btn.disabled = false;
      btn.setAttribute('role','listitem');
      btn.addEventListener('click', () => {
        if (opt.effect) opt.effect();
        currentNodeKey = opt.next;
        questionMemory[currentCharacter][opt.questionId] = (questionMemory[currentCharacter][opt.questionId] || 0) + 1;
        saveGame();
        showNode(opt.next);
      });
      choicesDiv.appendChild(btn);
    });
  }
  function updateInventoryUI() {
    // Seeds
    inventorySeeds.innerHTML = '';
    for (const [seedName, count] of Object.entries(inventory.seeds)) {
      if(count <= 0) continue;
      const div = document.createElement('div');
      div.className = 'invItem';
      div.textContent = `${seedName.charAt(0).toUpperCase() + seedName.slice(1)} (${count})`;
      inventorySeeds.appendChild(div);
    }
    // Gifts
    inventoryGifts.innerHTML = '';
    for (const [giftName, count] of Object.entries(inventory.gifts)) {
      if(count <= 0) continue;
      const div = document.createElement('div');
      div.className = 'invItem';
      div.textContent = `${giftName.charAt(0).toUpperCase() + giftName.slice(1)} (${count})`;
      inventoryGifts.appendChild(div);
    }
  }

  // === Dialogue System ===
  function showNode(nodeKey) {
    if (!nodeKey) return;
    const char = characters[currentCharacter];
    const node = char.dialogue[nodeKey];
    if (!node) {
      dialogueText.textContent = "Error: dialogue node not found.";
      clearChoices();
      return;
    }

    // Handle timed nodes
    if(timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }
    timeLeft = node.timed || 0;
    timerActive = timeLeft > 0;

    if(timerActive) {
      updateTimerBar();
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerBar();
        if(timeLeft <= 0) {
          clearInterval(timerInterval);
          timerInterval = null;
          timerActive = false;
          // Auto pick first choice or restart
          if(node.options.length > 0) {
            const opt = node.options[0];
            if(opt.effect) opt.effect();
            currentNodeKey = opt.next;
            saveGame();
            showNode(opt.next);
          }
        }
      }, 1000);
    } else {
      document.getElementById('timeBar').style.display = 'none';
    }

    // Show text (handle functions)
    let textOutput = typeof node.text === 'function' ? node.text(questionMemory[currentCharacter][nodeKey] || 0) : node.text;
    dialogueText.textContent = textOutput;

    // Show choices
    let optionsToShow = node.options;

    // If a gift is selected but no inventory, force nevermind
    if(nodeKey === 'giveGift') {
      giftArea.style.display = 'block';
      inventorySection.style.display = 'none';
      characterSelect.style.display = 'none';
      setChoices(node.options);
      return;
    } else {
      giftArea.style.display = 'none';
      inventorySection.style.display = 'flex';
      characterSelect.style.display = 'flex';
    }

    setChoices(optionsToShow);
    updateAvatar();
    updateBackground();
    updateStatus();
    updateInventoryUI();
  }

  // === Timer bar update ===
  function updateTimerBar() {
    const bar = document.getElementById('timeBar');
    const prog = document.getElementById('timeProgress');
    if(timeLeft <= 0) {
      bar.style.display = 'none';
    } else {
      bar.style.display = 'block';
      prog.style.width = `${(timeLeft / timeLimit) * 100}%`;
    }
  }

  // === Character Switching ===
  charButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      if(timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      charButtons.forEach(b => {
        b.classList.remove('selected');
        b.setAttribute('aria-pressed', 'false');
      });
      btn.classList.add('selected');
      btn.setAttribute('aria-pressed', 'true');
      currentCharacter = btn.dataset.char;
      currentNodeKey = "start";
      saveGame();
      showNode("start");
    });
  });

  // === Gift buttons ===
  giftButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const gift = btn.dataset.gift;
      if(inventory.gifts[gift] > 0) {
        // Trigger gift dialogue
        const giftNode = `gift${gift.charAt(0).toUpperCase() + gift.slice(1)}`;
        currentNodeKey = giftNode;
        saveGame();
        showNode(giftNode);
      } else {
        showMessage(`You don't have any ${gift}s left!`);
      }
    });
  });

  // === Avatar customization & start game ===
  startGameBtn.addEventListener('click', () => {
    avatarStyle = avatarStyleSelect.value;
    avatarColor = avatarColorInput.value;
    avatarCustomization.style.display = 'none';
    characterSelect.style.display = 'flex';
    inventorySection.style.display = 'flex';
    giftArea.style.display = 'none';
    currentNodeKey = "start";
    saveGame();
    showNode("start");
  });

  // === Save/load on startup ===
  if(!loadGame()) {
    // Show avatar customization by default
    avatarCustomization.style.display = 'flex';
    characterSelect.style.display = 'none';
    inventorySection.style.display = 'none';
    giftArea.style.display = 'none';
  } else {
    avatarCustomization.style.display = 'none';
    characterSelect.style.display = 'flex';
    inventorySection.style.display = 'flex';
    giftArea.style.display = 'none';
    showNode(currentNodeKey || "start");
  }

  // === Time progression ===
  function advanceTime() {
    timeOfDayIndex++;
    if(timeOfDayIndex >= timesOfDay.length) {
      timeOfDayIndex = 0;
      day++;
    }
    saveGame();
    showNode(currentNodeKey);
  }
  setInterval(advanceTime, 60000); // Advance time every 60 seconds

  // === Keyboard shortcuts ===
  document.addEventListener('keydown', e => {
    if(e.key === "Enter") {
      // Auto pick first choice if timer expired or active
      if(!timerActive && choicesDiv.children.length > 0) {
        choicesDiv.children[0].click();
      }
    }
  });

  // === Initial update ===
  updateInventoryUI();
  updateStatus();

})();
</script>
</body>
</html>
