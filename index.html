<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Event Alerts Wordle</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tile.revealed {
      transition: background-color 0.3s, border-color 0.3s;
    }
    .key {
      @apply bg-gray-700 text-white px-2 py-2 rounded-md font-bold text-sm m-1 w-8 h-10 flex items-center justify-center select-none shadow;
    }
    .key-row {
      @apply flex justify-center;
    }
    .key-row:nth-child(2) .key {
      margin-left: 6px;
    }
    .keyboard {
      @apply mt-6;
    }
  </style>
</head>
<body class="bg-black text-white min-h-screen flex items-center justify-center">
  <main class="text-center">
    <h1 class="text-3xl font-bold mb-6">Event Alerts Wordle</h1>
    <div id="wordle-game" class="space-y-2 mb-4"></div>

    <div class="keyboard">
      <div class="key-row">
        "QWERTYUIOP".split("").forEach(k => document.write(`<button class='key' data-key='${k}'>${k}</button>`));
      </div>
      <div class="key-row">
        "ASDFGHJKL".split("").forEach(k => document.write(`<button class='key' data-key='${k}'>${k}</button>`));
      </div>
      <div class="key-row">
        <button class="key w-16" data-key="ENTER">â†µ</button>
        "ZXCVBNM".split("").forEach(k => document.write(`<button class='key' data-key='${k}'>${k}</button>`));
        <button class="key w-16" data-key="BACKSPACE">âŒ«</button>
      </div>
    </div>

    <div id="stats" class="mt-6 text-center text-sm"></div>
  </main>

  <script>
    const encoded = "YXBwbGUsZXZlbnQsbW9kZW0sc2tlcHAsdXRpbHMsYWxlcnQsdHJhY2ssZmlnaHQsZ2FtZXMscGFydHk=";
    const WORDS = atob(encoded).split(",");
    const targetWord = WORDS[Math.floor(Math.random() * WORDS.length)].toUpperCase();
    const MAX_GUESSES = 6;

    let currentGuess = "";
    let currentRow = 0;
    let guessHistory = [];
    const date = new Date().toISOString().slice(0, 10);

    const game = document.getElementById("wordle-game");

    for (let r = 0; r < MAX_GUESSES; r++) {
      const row = document.createElement("div");
      row.className = "flex justify-center gap-2";
      for (let c = 0; c < 5; c++) {
        const tile = document.createElement("div");
        tile.className = "tile w-14 h-14 border-2 border-gray-600 text-2xl flex items-center justify-center uppercase font-bold bg-gray-800 text-white";
        row.appendChild(tile);
      }
      game.appendChild(row);
    }

    function updateRow() {
      const row = game.children[currentRow];
      for (let i = 0; i < 5; i++) {
        const cell = row.children[i];
        cell.textContent = currentGuess[i] || "";
        cell.classList.remove("revealed");
        cell.style.backgroundColor = "#1f2937";
        cell.style.borderColor = "#4b5563";
      }
    }

    function getEmojiRow(guess) {
      let result = "";
      let used = targetWord.split("");

      for (let i = 0; i < 5; i++) {
        if (guess[i] === targetWord[i]) {
          result += "ðŸŸ©";
          used[i] = null;
        } else if (used.includes(guess[i])) {
          result += "ðŸŸ¨";
          used[used.indexOf(guess[i])] = null;
        } else {
          result += "â¬›";
        }
      }
      return result;
    }

    function revealGuess() {
      const row = game.children[currentRow];
      const guess = currentGuess.toUpperCase();
      const used = targetWord.split("");
      const emojiRow = getEmojiRow(guess);

      guessHistory.push(emojiRow);

      for (let i = 0; i < 5; i++) {
        const cell = row.children[i];
        const letter = guess[i];

        setTimeout(() => {
          cell.classList.add("revealed");

          if (letter === targetWord[i]) {
            cell.style.backgroundColor = "#16a34a";
            cell.style.borderColor = "#16a34a";
          } else if (used.includes(letter)) {
            cell.style.backgroundColor = "#eab308";
            cell.style.borderColor = "#eab308";
            used[used.indexOf(letter)] = null;
          } else {
            cell.style.backgroundColor = "#374151";
            cell.style.borderColor = "#374151";
          }
        }, i * 300);
      }

      if (guess === targetWord) {
        setTimeout(() => {
          alert("You got it!");
          showShareButton();
          updateStats(true);
        }, 1800);
        disableInput();
      } else {
        currentRow++;
        currentGuess = "";
        if (currentRow >= MAX_GUESSES) {
          setTimeout(() => {
            alert(`Out of guesses! The word was ${targetWord}`);
            showShareButton(true);
            updateStats(false);
          }, 1800);
          disableInput();
        }
      }
    }

    function handleInput(key) {
      if (currentRow >= MAX_GUESSES) return;

      if (key === "BACKSPACE") {
        currentGuess = currentGuess.slice(0, -1);
        updateRow();
      } else if (/^[A-Z]$/.test(key) && currentGuess.length < 5) {
        currentGuess += key;
        updateRow();
      } else if (key === "ENTER" && currentGuess.length === 5) {
        revealGuess();
      }
    }

    function disableInput() {
      document.removeEventListener("keydown", keyListener);
      document.querySelectorAll(".key").forEach(k => k.disabled = true);
    }

    function keyListener(e) {
      handleInput(e.key.toUpperCase());
    }

    document.addEventListener("keydown", keyListener);

    document.querySelectorAll(".key").forEach(button => {
      button.addEventListener("click", () => {
        const key = button.getAttribute("data-key");
        handleInput(key);
      });
    });

    function showShareButton(failed = false) {
      const shareBox = document.createElement("div");
      shareBox.className = "mt-6 text-center";

      const emojiBlock = guessHistory.join("\n");
      const header = `Event Alerts Wordle â€” ${date}`;
      const score = `${failed ? "X" : currentRow + 1}/${MAX_GUESSES}`;
      const resultText = `${header}\n${score}\n${emojiBlock}`;

      const btn = document.createElement("button");
      btn.className = "mt-4 bg-cyan-500 hover:bg-cyan-600 text-black font-bold px-6 py-3 rounded-md text-sm uppercase tracking-widest select-none shadow-md";
      btn.innerText = "Copy Result";

      btn.addEventListener("click", () => {
        navigator.clipboard.writeText(resultText).then(() => {
          btn.innerText = "Copied!";
          setTimeout(() => (btn.innerText = "Copy Result"), 2000);
        });
      });

      const again = document.createElement("button");
      again.className = "ml-2 bg-gray-500 hover:bg-gray-600 text-white font-bold px-6 py-3 rounded-md text-sm uppercase tracking-widest select-none shadow-md";
      again.innerText = "Play Again";
      again.onclick = () => window.location.reload();

      const pre = document.createElement("pre");
      pre.className = "whitespace-pre-wrap text-sm text-left text-white bg-black bg-opacity-50 p-4 rounded-lg max-w-md mx-auto border border-white mt-2";
      pre.innerText = resultText;

      shareBox.appendChild(pre);
      shareBox.appendChild(btn);
      shareBox.appendChild(again);
      document.querySelector("main").appendChild(shareBox);
    }

    function updateStats(win) {
      let streak = parseInt(localStorage.getItem("wordleStreak")) || 0;
      let lastDate = localStorage.getItem("lastWordleDate");

      if (lastDate !== date) {
        if (win) streak++;
        else streak = 0;
        localStorage.setItem("wordleStreak", streak);
        localStorage.setItem("lastWordleDate", date);
      }

      document.getElementById("stats").textContent = `Streak: ${streak}`;
    }

    updateStats(false);
  </script>
</body>
</html>
