<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Auto Chess Lite</title>
<style>
  body {
    margin: 0;
    background: #222;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
  }
  h1 {
    margin-bottom: 10px;
    color: #f3da0b;
  }
  #gameContainer {
    display: flex;
    gap: 20px;
  }
  #board {
    background: #333;
    border: 3px solid #f3da0b;
    display: grid;
    grid-template-columns: repeat(5, 80px);
    grid-template-rows: repeat(4, 80px);
    gap: 4px;
    padding: 10px;
  }
  .cell {
    background: #444;
    border-radius: 8px;
    position: relative;
    cursor: pointer;
    box-shadow: inset 0 0 8px #111;
  }
  .cell.occupied {
    background: #1e7f7f;
    box-shadow: 0 0 10px #14b3b3;
  }
  .unit {
    width: 70px;
    height: 70px;
    background: #f3da0b;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-weight: 700;
    color: #222;
    user-select: none;
  }
  .unit.enemy {
    background: #f34b4b;
    color: #fff;
  }
  #shop {
    background: #333;
    border: 3px solid #f3da0b;
    border-radius: 12px;
    padding: 10px;
    width: 300px;
  }
  #shop h2 {
    margin-top: 0;
    margin-bottom: 8px;
  }
  .shop-unit {
    background: #555;
    border-radius: 8px;
    padding: 8px;
    margin-bottom: 10px;
    cursor: pointer;
    user-select: none;
    transition: background 0.3s;
  }
  .shop-unit:hover {
    background: #777;
  }
  .stats {
    font-size: 14px;
    margin-top: 4px;
    color: #ccc;
  }
  #controls {
    margin-top: 15px;
  }
  button {
    background: #f3da0b;
    border: none;
    padding: 10px 20px;
    border-radius: 12px;
    font-weight: 700;
    cursor: pointer;
    color: #222;
    user-select: none;
  }
  button:disabled {
    background: #bbb;
    cursor: default;
  }
  #message {
    margin-top: 15px;
    font-size: 20px;
    font-weight: 700;
  }
  #gold {
    margin-bottom: 10px;
  }
</style>
</head>
<body>

<h1>Auto Chess Lite</h1>
<div id="gold">Gold: 10</div>
<div id="gameContainer">
  <div id="board"></div>
  <div id="shop">
    <h2>Shop</h2>
    <div id="shopUnits"></div>
  </div>
</div>
<div id="controls">
  <button id="startBattleBtn">Start Battle</button>
  <button id="resetBtn" style="display:none;">Reset Game</button>
</div>
<div id="message"></div>

<script>
(() => {
  // Constants
  const ROWS = 4;
  const COLS = 5;

  // Game state
  let gold = 10;
  let playerUnits = []; // placed on board
  let enemyUnits = [];  // placed on board
  let isBattleStarted = false;

  // DOM elements
  const boardEl = document.getElementById('board');
  const shopUnitsEl = document.getElementById('shopUnits');
  const goldEl = document.getElementById('gold');
  const startBtn = document.getElementById('startBattleBtn');
  const resetBtn = document.getElementById('resetBtn');
  const messageEl = document.getElementById('message');

  // Board cells: track what's placed in each cell
  // null = empty, {unit} otherwise
  let boardCells = new Array(ROWS * COLS).fill(null);

  // Unit templates for shop
  const unitTemplates = [
    { id: 'soldier', name: 'Soldier', cost: 3, hp: 10, attack: 3 },
    { id: 'archer', name: 'Archer', cost: 4, hp: 6, attack: 5 },
    { id: 'tank', name: 'Tank', cost: 6, hp: 20, attack: 2 },
  ];

  // Enemy unit templates (for AI)
  const enemyTemplates = [
    { id: 'enemySoldier', name: 'Enemy Soldier', hp: 10, attack: 3 },
    { id: 'enemyArcher', name: 'Enemy Archer', hp: 6, attack: 5 },
    { id: 'enemyTank', name: 'Enemy Tank', hp: 20, attack: 2 },
  ];

  // Initialize the board UI
  function createBoard() {
    boardEl.innerHTML = '';
    for(let r=0; r<ROWS; r++) {
      for(let c=0; c<COLS; c++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.dataset.index = r * COLS + c;
        // Player side: rows 2 and 3 (bottom two rows)
        if (r >= 2) cell.style.background = '#2a2a2a';
        else cell.style.background = '#222';
        boardEl.appendChild(cell);
      }
    }
  }

  // Update gold display
  function updateGold() {
    goldEl.textContent = `Gold: ${gold}`;
  }

  // Create shop UI
  function createShop() {
    shopUnitsEl.innerHTML = '';
    unitTemplates.forEach(unit => {
      const div = document.createElement('div');
      div.classList.add('shop-unit');
      div.textContent = `${unit.name} - Cost: ${unit.cost}g`;
      const stats = document.createElement('div');
      stats.className = 'stats';
      stats.textContent = `HP: ${unit.hp} | ATK: ${unit.attack}`;
      div.appendChild(stats);

      div.addEventListener('click', () => {
        if (gold >= unit.cost && !isBattleStarted) {
          selectedShopUnit = {...unit}; // copy for placement
          messageEl.textContent = `Selected ${unit.name}, click a cell in your side to place.`;
        } else if (!isBattleStarted) {
          messageEl.textContent = `Not enough gold to buy ${unit.name}.`;
        }
      });

      shopUnitsEl.appendChild(div);
    });
  }

  // Selected unit to place
  let selectedShopUnit = null;

  // Place unit on board
  boardEl.addEventListener('click', e => {
    if (!selectedShopUnit || isBattleStarted) return;

    const cell = e.target.closest('.cell');
    if (!cell) return;

    const idx = parseInt(cell.dataset.index);
    const row = Math.floor(idx / COLS);

    // Allow placing only on player side (rows 2 and 3)
    if (row < 2) {
      messageEl.textContent = "You can only place units on your side (bottom rows).";
      return;
    }

    if (boardCells[idx]) {
      messageEl.textContent = "Cell is already occupied.";
      return;
    }

    // Place unit
    const unit = {
      ...selectedShopUnit,
      hp: selectedShopUnit.hp,
      maxHp: selectedShopUnit.hp,
      id: selectedShopUnit.id + '_' + Date.now() + Math.random(),
      row: row,
      col: idx % COLS,
      isEnemy: false,
    };
    boardCells[idx] = unit;
    playerUnits.push(unit);

    gold -= selectedShopUnit.cost;
    updateGold();
    selectedShopUnit = null;
    messageEl.textContent = "Unit placed.";

    updateBoardUI();
  });

  // Update board UI to show units
  function updateBoardUI() {
    const cells = boardEl.querySelectorAll('.cell');
    cells.forEach((cell, i) => {
      cell.innerHTML = '';
      const unit = boardCells[i];
      if (unit) {
        const unitDiv = document.createElement('div');
        unitDiv.className = 'unit' + (unit.isEnemy ? ' enemy' : '');
        unitDiv.textContent = unit.name[0];
        // HP bar
        const hpBar = document.createElement('div');
        hpBar.style.position = 'absolute';
        hpBar.style.bottom = '4px';
        hpBar.style.left = '5px';
        hpBar.style.width = '70px';
        hpBar.style.height = '8px';
        hpBar.style.background = '#555';
        hpBar.style.borderRadius = '4px';

        const hpFill = document.createElement('div');
        hpFill.style.height = '8px';
        hpFill.style.background = unit.isEnemy ? '#f34b4b' : '#f3da0b';
        hpFill.style.width = (unit.hp / unit.maxHp * 100) + '%';
        hpFill.style.borderRadius = '4px';

        hpBar.appendChild(hpFill);
        unitDiv.appendChild(hpBar);

        cell.appendChild(unitDiv);
        cell.classList.add('occupied');
      } else {
        cell.classList.remove('occupied');
      }
    });
  }

  // Spawn enemy units randomly on top rows (0 and 1)
  function spawnEnemies() {
    enemyUnits = [];
    for(let r=0; r<2; r++) {
      for(let c=0; c<COLS; c++) {
        if (Math.random() < 0.4) {
          const template = enemyTemplates[Math.floor(Math.random() * enemyTemplates.length)];
          const unit = {
            ...template,
            hp: template.hp,
            maxHp: template.hp,
            id: template.id + '_' + Date.now() + Math.random(),
            row: r,
            col: c,
            isEnemy: true,
          };
          enemyUnits.push(unit);
          boardCells[r * COLS + c] = unit;
        }
      }
    }
  }

  // Clear enemies from board
  function clearEnemies() {
    enemyUnits.forEach(eu => {
      const idx = eu.row * COLS + eu.col;
      if (boardCells[idx] && boardCells[idx].id === eu.id) {
        boardCells[idx] = null;
      }
    });
    enemyUnits = [];
  }

  // Combat loop - units attack opposing units in same column, adjacent row
  function combatRound() {
    // Simple AI: each unit attacks one enemy unit in adjacent row(s) same column
    const allUnits = playerUnits.concat(enemyUnits);

    // Shuffle attack order
    const shuffled = allUnits.slice().sort(() => Math.random() - 0.5);

    for (const unit of shuffled) {
      if (unit.hp <= 0) continue;

      // Find target in opposing team in adjacent row(s)
      const opposingUnits = unit.isEnemy ? playerUnits : enemyUnits;
      // Candidate targets: same col, row +1 or -1
      const targets = opposingUnits.filter(u =>
        u.col === unit.col && Math.abs(u.row - unit.row) <= 1 && u.hp > 0
      );
      if (targets.length === 0) continue;

      // Random target from candidates
      const target = targets[Math.floor(Math.random() * targets.length)];
      target.hp -= unit.attack;
      if (target.hp < 0) target.hp = 0;
    }

    // Remove dead units from board
    playerUnits = playerUnits.filter(u => u.hp > 0);
    enemyUnits = enemyUnits.filter(u => u.hp > 0);

    // Update board cells
    boardCells = boardCells.map(cell => {
      if (!cell) return null;
      if (cell.hp <= 0) return null;
      return cell;
    });

    updateBoardUI();
  }

  // Check if battle ended
  function checkBattleEnd() {
    if (playerUnits.length === 0) {
      messageEl.textContent = 'You Lost!';
      return 'lost';
    }
    if (enemyUnits.length === 0) {
      messageEl.textContent = 'You Won!';
      return 'won';
    }
    return null;
  }

  // Start battle
  async function startBattle() {
    if (isBattleStarted) return;
    if (playerUnits.length === 0) {
      messageEl.textContent = 'Place at least one unit to start battle.';
      return;
    }

    isBattleStarted = true;
    messageEl.textContent = 'Battle started!';

    // Spawn enemies
    spawnEnemies();
    updateBoardUI();

    startBtn.disabled = true;

    // Run battle rounds until one side is defeated
    while (true) {
      combatRound();
      await new Promise(r => setTimeout(r, 1000)); // wait 1s between rounds
      const result = checkBattleEnd();
      if (result) break;
    }

    resetBtn.style.display = 'inline-block';
  }

  // Reset game
  function resetGame() {
    gold = 10;
    playerUnits = [];
    enemyUnits = [];
    boardCells = new Array(ROWS * COLS).fill(null);
    isBattleStarted = false;
    messageEl.textContent = '';
    startBtn.disabled = false;
    resetBtn.style.display = 'none';
    selectedShopUnit = null;
    updateGold();
    createBoard();
    createShop();
    updateBoardUI();
  }

  // Initialize UI
  createBoard();
  createShop();
  updateGold();

  startBtn.addEventListener('click', startBattle);
  resetBtn.addEventListener('click', resetGame);

})();
</script>

</body>
</html>
