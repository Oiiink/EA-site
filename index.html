<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Event Alerts â€” Wrapped</title>
<meta name="description" content="Event Alerts Wrapped â€” your year in events.">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg-dark:#050507;
    --bg-2:#0e0a0a;
    --accent:#ff8a22;
    --accent-2:#ffb36b;
    --muted: #bdb6b1;
    --card: rgba(255,255,255,0.03);
    --glass: rgba(255,255,255,0.04);
    --glass-strong: rgba(255,255,255,0.06);
  }

  /* Reset */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    background:
      radial-gradient(1200px 600px at 10% 10%, rgba(255,138,34,0.06), transparent 6%),
      linear-gradient(180deg,var(--bg-dark), var(--bg-2));
    color:#fff;
    -webkit-font-smoothing:antialiased;
    overflow:hidden;
  }

  /* App shell */
  .app {
    width:100%;
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
  }

  .card-stage {
    width:100%;
    max-width:1200px;
    height:82vh;
    border-radius:18px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow: 0 30px 90px rgba(0,0,0,0.6);
    position:relative;
    overflow:hidden;
    display:flex;
  }

  /* side panel area (right) */
  .sidebar {
    width:360px;
    border-left: 1px solid rgba(255,255,255,0.03);
    padding:28px;
    background: linear-gradient(90deg, rgba(255,255,255,0.015), transparent);
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .stage-left {
    flex:1.4;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:36px;
    position:relative;
  }

  /* Pages (horizontal slider) */
  .pages {
    width:100%;
    height:100%;
    position:relative;
    perspective:1200px;
    overflow:hidden;
  }

  .page {
    position:absolute;
    top:0; left:0;
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    transform: translateX(120%) scale(.98);
    opacity:0;
    transition: transform 760ms cubic-bezier(.18,.9,.32,1), opacity 480ms ease;
    will-change: transform, opacity;
    padding:44px;
  }

  .page.active {
    transform: translateX(0) scale(1);
    opacity:1;
  }

  .page.prev {
    transform: translateX(-120%) scale(.96);
    opacity:0;
  }

  /* hero card area inside slide */
  .hero {
    width:100%;
    max-width:900px;
    height:72%;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;
    padding:28px;
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:18px;
    align-items:center;
    box-shadow: 0 20px 60px rgba(0,0,0,0.6), 0 0 40px rgba(255,138,34,0.04) inset;
    border: 1px solid rgba(255,255,255,0.04);
  }

  /* mobile fallback hero */
  @media (max-width:1000px){
    .hero{ grid-template-columns: 1fr; height:78%}
    .sidebar{ display:none }
  }

  .hero-left {
    height:100%;
    display:flex;
    flex-direction:column;
    gap:14px;
    justify-content:center;
  }

  .logo {
    width:86px;
    height:86px;
    border-radius:14px;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    box-shadow: 0 6px 20px rgba(0,0,0,0.5);
  }

  .big-title {
    font-size:28px;
    font-weight:800;
    color:var(--accent);
    letter-spacing:-0.01em;
    text-shadow: 0 8px 30px rgba(255,138,34,0.08);
  }
  .subtitle {
    color:var(--muted);
    font-size:14px;
  }

  .stat-grid {
    display:flex;
    gap:12px;
    margin-top:12px;
    flex-wrap:wrap;
  }

  .stat {
    min-width:160px;
    background: linear-gradient(180deg, rgba(255,255,255,0.014), rgba(255,255,255,0.01));
    padding:12px;
    border-radius:10px;
    border: 1px solid rgba(255,255,255,0.03);
    box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  }
  .stat .label{ font-size:12px; color:var(--muted) }
  .stat .value{ font-size:20px; font-weight:800; color:#fff; margin-top:6px }

  /* right column area inside hero for highlights / chart */
  .hero-right {
    display:flex;
    flex-direction:column;
    gap:12px;
    align-items:center;
    justify-content:center;
    padding:8px;
  }

  .pill {
    padding:10px 14px;
    border-radius:12px;
    background: linear-gradient(90deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
    font-weight:700;
    color:var(--accent-2);
    border:1px solid rgba(255,255,255,0.03);
  }

  .sparkline-wrap { width:100%; display:flex; justify-content:center; align-items:center; gap:10px; flex-direction:column; }
  .sparkline { width:220px; height:80px; border-radius:8px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008)); display:flex; align-items:center; justify-content:center; border:1px solid rgba(255,255,255,0.03); }

  /* Sidebar */
  .progress { height:8px; background: rgba(255,255,255,0.03); border-radius:8px; overflow:hidden; }
  .progress > div { height:100%; width:0%; background: linear-gradient(90deg,var(--accent),var(--accent-2)); transition: width 700ms cubic-bezier(.18,.9,.32,1);}

  .controls { display:flex; gap:8px; margin-top:8px; }
  .btn { padding:10px 12px; border-radius:10px; border:none; cursor:pointer; font-weight:700; font-size:13px; }
  .btn.primary { background: linear-gradient(90deg,var(--accent),var(--accent-2)); color:#100; box-shadow: 0 14px 40px rgba(255,138,34,0.12); }
  .btn.ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); }

  .muted { color:var(--muted); font-size:12px; }
  .small { font-size:12px; color:var(--muted) }

  /* final share card */
  .share-card {
    width:560px;
    border-radius:14px;
    padding:18px;
    display:flex;
    gap:12px;
    align-items:center;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  }
  .share-left { width:92px; height:92px; border-radius:12px; overflow:hidden; }
  .share-main { flex:1; }
  .share-title { font-weight:800; color:var(--accent); font-size:18px; }
  .share-line { font-size:13px; color:var(--muted) }

  /* confetti canvas */
  #confetti { position:absolute; inset:0; pointer-events:none; z-index:22 }

  /* small helpers */
  .center { display:flex; align-items:center; justify-content:center; }
  .sm { font-size:13px }

</style>
</head>
<body>
  <div class="app">
    <div class="card-stage" role="application" aria-label="Event Alerts Wrapped">
      <canvas id="confetti"></canvas>

      <div class="stage-left">
        <div class="pages" id="pages">
          <!-- Slide 0: intro -->
          <section class="page active" data-idx="0" aria-hidden="false">
            <div class="hero">
              <div class="hero-left">
                <div style="display:flex;gap:16px;align-items:center">
                  <div class="logo"><img src="assets/images/logo.png" alt="logo" style="width:100%;height:100%;object-fit:cover"></div>
                  <div>
                    <div class="big-title">Event Alerts â€” Wrapped</div>
                    <div class="subtitle">A year in events â€” your Player, Host & Community highlights</div>
                  </div>
                </div>

                <div style="display:flex;gap:12px;margin-top:18px;flex-wrap:wrap">
                  <div class="stat">
                    <div class="label">Snapshot</div>
                    <div class="value" id="snapshot-players">â€” players</div>
                  </div>
                  <div class="stat">
                    <div class="label">Events this period</div>
                    <div class="value" id="snapshot-events">â€”</div>
                  </div>
                  <div class="stat">
                    <div class="label">Total money</div>
                    <div class="value" id="snapshot-money">$â€”</div>
                  </div>
                </div>

                <div style="margin-top:18px; display:flex; gap:10px; align-items:center">
                  <button class="btn primary" id="startBtn">Reveal Stats</button>
                  <button class="btn ghost" id="demoBtn">Load Demo</button>
                  <div style="margin-left:auto" class="small muted">Use arrow keys to navigate</div>
                </div>
              </div>

              <div class="hero-right">
                <div class="pill">2025 Wrapped</div>
                <div class="sparkline-wrap">
                  <div class="sparkline" id="sparklineIntro">
                    <!-- SVG sparkline injected by script -->
                  </div>
                  <div class="small muted">Events per month</div>
                </div>
              </div>
            </div>
          </section>

          <!-- Slide 1: Player stats -->
          <section class="page" data-idx="1" aria-hidden="true">
            <div class="hero">
              <div class="hero-left">
                <div style="display:flex;gap:12px;align-items:center">
                  <div class="big-title">Player Stats</div>
                  <div class="subtitle sm" style="font-weight:600;color:var(--muted)">Community / Partner / Skeppy</div>
                </div>

                <div class="stat-grid" style="margin-top:12px" id="playerStatsGrid">
                  <div class="stat">
                    <div class="label">Events Played</div>
                    <div class="value" id="eventsPlayed">0</div>
                  </div>
                  <div class="stat">
                    <div class="label">Events Won</div>
                    <div class="value" id="eventsWon">0</div>
                  </div>
                  <div class="stat">
                    <div class="label">Favorite Server</div>
                    <div class="value" id="favoriteServer">â€”</div>
                  </div>
                  <div class="stat">
                    <div class="label">Times Joined</div>
                    <div class="value" id="serverJoins">0</div>
                  </div>
                </div>

                <div style="margin-top:16px">
                  <div class="label sm muted">Top 5 Events Played</div>
                  <div id="playerTopBars" style="margin-top:8px; display:flex;flex-direction:column;gap:8px"></div>
                </div>

              </div>

              <div class="hero-right">
                <div class="pill" id="playerBadge">Player</div>
                <div class="sparkline-wrap">
                  <div class="sparkline" id="playerSpark"></div>
                  <div class="small muted">Monthly play trend</div>
                </div>
              </div>
            </div>
          </section>

          <!-- Slide 2: Host stats -->
          <section class="page" data-idx="2" aria-hidden="true">
            <div class="hero">
              <div class="hero-left">
                <div style="display:flex;gap:12px;align-items:center">
                  <div class="big-title">Hosting Stats</div>
                  <div class="subtitle sm" style="font-weight:600;color:var(--muted)">Community & Partner host metrics</div>
                </div>

                <div class="stat-grid" style="margin-top:12px">
                  <div class="stat">
                    <div class="label">Events Hosted</div>
                    <div class="value" id="eventsHosted">0</div>
                  </div>
                  <div class="stat">
                    <div class="label">Most Popular Month</div>
                    <div class="value" id="popularMonth">â€”</div>
                  </div>
                  <div class="stat">
                    <div class="label">Money Given</div>
                    <div class="value" id="moneyGiven">$0</div>
                  </div>
                  <div class="stat">
                    <div class="label">Host Percentile</div>
                    <div class="value" id="hostPercent">0%</div>
                  </div>
                  <div class="stat">
                    <div class="label">Best Time Boost</div>
                    <div class="value" id="popIncrease">0%<div class="small muted">at <b id="bestTime">â€”</b></div></div>
                  </div>
                </div>

                <div style="margin-top:16px">
                  <div class="label sm muted">Most players per hour (by time slot)</div>
                  <div id="hostHourBars" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap"></div>
                </div>
              </div>

              <div class="hero-right">
                <div class="pill" id="hostBadge">Host</div>
                <div class="sparkline-wrap">
                  <div class="sparkline" id="hostSpark"></div>
                  <div class="small muted">Players per hosted event</div>
                </div>
              </div>
            </div>
          </section>

          <!-- Slide 3: Community -->
          <section class="page" data-idx="3" aria-hidden="true">
            <div class="hero" style="grid-template-columns:1fr;">
              <div class="hero-left">
                <div class="big-title">Community Wrapped â€” Overall Stats</div>
                <div class="subtitle">Big-picture metrics for this timeframe</div>

                <div class="stat-grid" style="margin-top:14px">
                  <div class="stat">
                    <div class="label">Community Events Hosted</div>
                    <div class="value" id="communityHosted">0</div>
                  </div>
                  <div class="stat">
                    <div class="label">Partner Events Hosted</div>
                    <div class="value" id="partnerHosted">0</div>
                  </div>
                  <div class="stat">
                    <div class="label">People Who Hosted</div>
                    <div class="value" id="totalHosts">0</div>
                  </div>
                  <div class="stat">
                    <div class="label">Money Given Away</div>
                    <div class="value" id="totalMoney">$0</div>
                  </div>
                  <div class="stat">
                    <div class="label">Most Active Community Event</div>
                    <div class="value" id="mostActiveCommunity">â€”</div>
                  </div>
                  <div class="stat">
                    <div class="label">Most Active Partner Event</div>
                    <div class="value" id="mostActivePartner">â€”</div>
                  </div>
                  <div class="stat">
                    <div class="label">Most Active Money Host</div>
                    <div class="value" id="topMoneyHost">â€”</div>
                  </div>
                </div>

                <div style="margin-top:18px" class="center">
                  <div class="share-card" id="shareCard">
                    <div class="share-left"><img src="assets/images/logo.png" alt="" style="width:100%;height:100%;object-fit:cover;border-radius:10px"></div>
                    <div class="share-main">
                      <div class="share-title" id="shareTitle">Event Alerts Wrapped</div>
                      <div class="share-line" id="shareSubtitle">You joined 0 events â€¢ Hosted 0 events</div>
                    </div>
                    <div style="margin-left:auto; text-align:right">
                      <div style="font-weight:800;color:var(--accent)">Share</div>
                      <div class="small muted">PNG export below</div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </section>

          <!-- Slide 4: Finale -->
          <section class="page" data-idx="4" aria-hidden="true">
            <div class="hero" style="grid-template-columns:1fr;">
              <div class="hero-left center" style="flex-direction:column;gap:12px">
                <div class="big-title">Thatâ€™s a wrap ðŸŽ‰</div>
                <div class="subtitle">Share your summary with friends, or keep it to yourself â€” we wonâ€™t tell ðŸ˜‰</div>
                <div style="margin-top:10px" id="finalSummary" class="sm muted">You joined <b id="finalJoins">0</b> events and hosted <b id="finalHosts">0</b>.</div>

                <div style="display:flex;gap:10px;margin-top:18px">
                  <button class="btn primary" id="downloadBtn">Download PNG</button>
                  <button class="btn ghost" id="tweetBtn">Share on Twitter</button>
                </div>
              </div>
            </div>
          </section>

        </div>
      </div>

      <!-- Sidebar controls -->
      <aside class="sidebar" aria-hidden="false">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:800;color:var(--accent)">Event Alerts</div>
            <div class="muted" style="font-size:13px">Wrapped â€¢ 2025</div>
          </div>
          <div style="text-align:right">
            <div style="font-weight:800">v1</div>
            <div class="muted small">Demo</div>
          </div>
        </div>

        <div class="progress" aria-hidden="true"><div id="progressBar"></div></div>

        <div style="display:flex;gap:8px">
          <button class="btn ghost" id="prevBtn" aria-label="Previous">Prev</button>
          <button class="btn primary" id="nextBtn" aria-label="Next">Next</button>
        </div>

        <input id="usernameInput" placeholder="Enter username (demo)" style="margin-top:8px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:white" />

        <div style="display:flex;gap:8px;margin-top:6px">
          <button class="btn ghost" id="loadBtn">Load User</button>
          <button class="btn ghost" id="randomBtn">Randomize</button>
        </div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn primary" id="downloadBtnSidebar">Download PNG</button>
          <button class="btn ghost" id="tweetBtnSidebar">Share</button>
        </div>

        <div style="margin-top:auto">
          <div class="muted small">Tip: Replace the <code>demoData</code> object in the script with your API output, then call <code>render(yourData)</code>.</div>
        </div>
      </aside>

    </div>
  </div>

  <!-- html2canvas for PNG export -->
  <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
/* ---------------- DEMO DATA (replace with your API) ---------------- */
const demoData = {
  username: "Oiiink YT",
  player: {
    eventsPlayed: 124,
    eventsWon: 9,
    favoriteServer: "SkyBlock Royale",
    serverJoins: 24,
    topEvents: [
      {name:"Halloween Bash", count:24},
      {name:"Build Battle", count:16},
      {name:"Spleef", count:10},
      {name:"Parkour Party", count:8},
      {name:"PixelGames", count:6}
    ],
    monthly: [6,8,10,12,14,18,22,8,6,4,3,13] // 12 months
  },
  host: {
    eventsHosted: 37,
    popularMonth: "June",
    moneyGiven: 1240,
    hostPercentile: 86,
    bestTime: "19:00 UTC",
    popIncrease: 22,
    hourly: [2,4,6,8,12,16,14,9,6,4,2,1], // players per hour sample
    hostMonthly: [2,3,2,5,4,6,7,3,2,1,1,1]
  },
  community: {
    communityHosted: 392,
    partnerHosted: 128,
    totalHosts: 214,
    totalMoney: 54000,
    mostActiveCommunity: "Community Build-Off",
    mostActivePartner: "PixelEvents Championship",
    topMoneyHost: "BigDonor123"
  }
};

/* ---------------- Page logic ---------------- */
const pages = Array.from(document.querySelectorAll('.page'));
let idx = 0;
const total = pages.length;
const progressBar = document.getElementById('progressBar');

// set active page and prev states
function setActive(i){
  pages.forEach((p, n) => {
    p.classList.remove('active','prev');
    p.setAttribute('aria-hidden','true');
    if(n === i) { p.classList.add('active'); p.setAttribute('aria-hidden','false'); }
    if(n < i) p.classList.add('prev');
  });
  idx = i;
  updateProgress();
  if(idx === total - 1) triggerConfetti();
}
function next(){ if(idx < total-1) setActive(idx+1); }
function prev(){ if(idx > 0) setActive(idx-1); }
document.getElementById('nextBtn').addEventListener('click', ()=>{ next(); if(idx===1) animatePageStats(1); });
document.getElementById('prevBtn').addEventListener('click', prev);
document.getElementById('startBtn').addEventListener('click', ()=> setActive(1));
document.getElementById('demoBtn').addEventListener('click', ()=> { render(demoData); setActive(1); });

document.getElementById('loadBtn').addEventListener('click', ()=>{
  // production: fetch from your API with usernameInput
  const u = document.getElementById('usernameInput').value.trim();
  if(!u){ alert('Enter a username for demo'); return; }
  // Demo behavior: slightly randomize demoData to feel unique per user
  const d = JSON.parse(JSON.stringify(demoData));
  d.username = u;
  d.player.eventsPlayed = d.player.eventsPlayed + Math.floor(Math.random()*40);
  d.host.eventsHosted = d.host.eventsHosted + Math.floor(Math.random()*20);
  d.community.totalMoney = d.community.totalMoney + Math.floor(Math.random()*30000);
  render(d);
  setActive(1);
});

document.getElementById('randomBtn').addEventListener('click', ()=>{
  const d = JSON.parse(JSON.stringify(demoData));
  d.player.eventsPlayed = Math.floor(Math.random()*300);
  d.player.eventsWon = Math.floor(Math.random()*40);
  d.host.eventsHosted = Math.floor(Math.random()*150);
  d.community.communityHosted = Math.floor(Math.random()*1000);
  render(d);
  setActive(1);
});

function updateProgress(){
  const pct = Math.round((idx / (total - 1)) * 100);
  progressBar.style.width = pct + '%';
}

// keyboard nav
window.addEventListener('keydown', (e)=>{
  if(e.key === 'ArrowRight') next();
  if(e.key === 'ArrowLeft') prev();
});

/* ---------------- Animated counter ---------------- */
function animateValue(el, to, duration=900, prefix='', suffix=''){
  const start = Number(el.textContent.replace(/[^0-9.-]/g,'')) || 0;
  const change = to - start;
  const startTime = performance.now();
  function step(now){
    const t = Math.min((now - startTime) / duration, 1);
    const val = Math.round(start + change * (1 - Math.pow(1 - t, 3)));
    el.textContent = prefix + Intl.NumberFormat().format(val) + suffix;
    if(t < 1) requestAnimationFrame(step);
    else el.textContent = prefix + Intl.NumberFormat().format(to) + suffix;
  }
  requestAnimationFrame(step);
}

/* ---------------- Drawing small charts (bars & sparklines) ---------------- */
/* Simple bar renderer for top events */
function renderTopBars(container, items, color){
  container.innerHTML = '';
  const max = Math.max(...items.map(i=>i.count), 1);
  items.forEach(it=>{
    const row = document.createElement('div');
    row.style.display = 'flex';
    row.style.alignItems = 'center';
    row.style.gap = '8px';
    row.style.fontSize = '13px';
    row.innerHTML = `
      <div style="width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${it.name}</div>
      <div style="flex:1;background:rgba(255,255,255,0.03);height:12px;border-radius:6px;position:relative">
        <div style="position:absolute;left:0;top:0;bottom:0;border-radius:6px;width:${Math.round((it.count/max)*100)}%;background:linear-gradient(90deg, ${color}, ${shade(color, 30)});"></div>
      </div>
      <div style="width:36px;text-align:right;font-weight:700">${it.count}</div>
    `;
    container.appendChild(row);
  });
}

/* render a tiny sparkline SVG */
function renderSparkline(el, data, stroke){
  const w = 220, h = 72, pad = 8;
  const max = Math.max(...data), min = Math.min(...data);
  const len = data.length;
  const points = data.map((v,i)=>{
    const x = pad + (i / (len-1)) * (w - pad*2);
    const y = pad + (1 - (v - min) / (max - min || 1)) * (h - pad*2);
    return `${x},${y}`;
  }).join(' ');
  el.innerHTML = `<svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="${stroke}" stop-opacity="0.9"/><stop offset="1" stop-color="${shade(stroke,40)}" stop-opacity="0.9"/></linearGradient></defs>
    <polyline points="${points}" fill="none" stroke="url(#g)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
  </svg>`;
}

/* hour bars for host */
function renderHourBars(container, hourly, accent){
  container.innerHTML = '';
  const max = Math.max(...hourly,1);
  hourly.forEach((v,i)=>{
    const wrap = document.createElement('div');
    wrap.style.width = 'calc(50% - 8px)';
    wrap.style.display = 'flex';
    wrap.style.flexDirection = 'column';
    wrap.style.gap = '6px';
    wrap.innerHTML = `<div style="height:10px;background:rgba(255,255,255,0.03);border-radius:6px;position:relative">
      <div style="position:absolute;left:0;top:0;bottom:0;width:${Math.round((v/max)*100)}%;background:linear-gradient(90deg, ${accent}, ${shade(accent,30)});border-radius:6px"></div>
    </div><div style="font-size:12px;color:var(--muted)">${i}:00</div>`;
    container.appendChild(wrap);
  });
}

/* tiny helper to darken / lighten hex */
function shade(hex, percent){
  // hex like #ff8a22
  const f = hex.slice(1);
  const r = parseInt(f.substring(0,2),16);
  const g = parseInt(f.substring(2,4),16);
  const b = parseInt(f.substring(4,6),16);
  const t = percent<0?0:255;
  const p = Math.abs(percent)/100;
  const R = Math.round((t - r)*p) + r;
  const G = Math.round((t - g)*p) + g;
  const B = Math.round((t - b)*p) + b;
  return `rgb(${R},${G},${B})`;
}

/* ---------------- render function to populate DOM ---------------- */
function render(data){
  // summary snapshot
  document.getElementById('snapshot-players').textContent = Intl.NumberFormat().format(data.community.totalHosts) + ' hosts';
  document.getElementById('snapshot-events').textContent = Intl.NumberFormat().format(data.player.eventsPlayed + data.host.eventsHosted);
  document.getElementById('snapshot-money').textContent = '$' + Intl.NumberFormat().format(data.community.totalMoney);

  // player
  animateValue(document.getElementById('eventsPlayed'), data.player.eventsPlayed);
  animateValue(document.getElementById('eventsWon'), data.player.eventsWon);
  document.getElementById('favoriteServer').textContent = data.player.favoriteServer || 'â€”';
  animateValue(document.getElementById('serverJoins'), data.player.serverJoins);
  renderTopBars(document.getElementById('playerTopBars'), data.player.topEvents.slice(0,5), getComputedStyle(document.documentElement).getPropertyValue('--accent') || '#ff8a22');
  renderSparkline(document.getElementById('playerSpark'), data.player.monthly, '#ff8a22');

  // host
  animateValue(document.getElementById('eventsHosted'), data.host.eventsHosted);
  document.getElementById('popularMonth').textContent = data.host.popularMonth || 'â€”';
  document.getElementById('moneyGiven').textContent = '$' + Intl.NumberFormat().format(data.host.moneyGiven || 0);
  document.getElementById('hostPercent').textContent = (data.host.hostPercentile || 0) + '%';
  document.getElementById('bestTime').textContent = data.host.bestTime || 'â€”';
  document.getElementById('popIncrease').textContent = (data.host.popIncrease || 0) + '%';
  renderHourBars(document.getElementById('hostHourBars'), data.host.hourly || [], '#ff8a22');
  renderSparkline(document.getElementById('hostSpark'), data.host.hostMonthly || [1,2,3,4,5,3,2,1], '#ff8a22');

  // community
  animateValue(document.getElementById('communityHosted'), data.community.communityHosted || 0);
  animateValue(document.getElementById('partnerHosted'), data.community.partnerHosted || 0);
  animateValue(document.getElementById('totalHosts'), data.community.totalHosts || 0);
  document.getElementById('totalMoney').textContent = '$' + Intl.NumberFormat().format(data.community.totalMoney || 0);
  document.getElementById('mostActiveCommunity').textContent = data.community.mostActiveCommunity || 'â€”';
  document.getElementById('mostActivePartner').textContent = data.community.mostActivePartner || 'â€”';
  document.getElementById('topMoneyHost').textContent = data.community.topMoneyHost || 'â€”';

  // share card & finale
  document.getElementById('shareTitle').textContent = `${data.username} â€¢ Event Alerts Wrapped`;
  document.getElementById('shareSubtitle').textContent = `You joined ${data.player.eventsPlayed} events â€¢ Hosted ${data.host.eventsHosted} events`;
  document.getElementById('finalJoins').textContent = Intl.NumberFormat().format(data.player.eventsPlayed);
  document.getElementById('finalHosts').textContent = Intl.NumberFormat().format(data.host.eventsHosted);

  // small intro sparkline
  renderSparkline(document.getElementById('sparklineIntro'), data.player.monthly || [1,2,3,4,5,6], '#ff8a22');
}

/* initial render with demo */
render(demoData);

/* animate numbers when page becomes active (optional) */
function animatePageStats(pageIndex){
  // this demo already animates on render; for per-page anims you could re-trigger certain values here
}

/* ---------------- PNG export (html2canvas) ---------------- */
async function exportPNG(){
  // hide sidebar so the left area is clean
  const sidebar = document.querySelector('.sidebar');
  sidebar.style.visibility = 'hidden';

  // snapshot the left stage (only)
  const left = document.querySelector('.stage-left');
  try {
    const canvas = await html2canvas(left, {scale:2, useCORS:true, backgroundColor: null});
    const a = document.createElement('a');
    a.href = canvas.toDataURL('image/png');
    a.download = (demoData.username || 'wrapped') + '-event-alerts-wrapped.png';
    document.body.appendChild(a); a.click(); a.remove();
  } catch(e){
    alert('Error exporting image: ' + e.message);
  } finally {
    sidebar.style.visibility = 'visible';
  }
}

document.getElementById('downloadBtn').addEventListener('click', exportPNG);
document.getElementById('downloadBtnSidebar').addEventListener('click', exportPNG);
document.getElementById('tweetBtn').addEventListener('click', ()=> { window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent('Check out my Event Alerts Wrapped â€” ' + demoData.username)}`,'_blank') });
document.getElementById('tweetBtnSidebar').addEventListener('click', ()=> { window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent('Check out my Event Alerts Wrapped â€” ' + demoData.username)}`,'_blank') });

/* ---------------- small confetti for finale ---------------- */
const confettiCanvas = document.getElementById('confetti');
const ctx = confettiCanvas.getContext('2d');
let confetti = [];
function resizeCanvas(){
  confettiCanvas.width = confettiCanvas.clientWidth;
  confettiCanvas.height = confettiCanvas.clientHeight;
}
window.addEventListener('resize', resizeCanvas); resizeCanvas();

function triggerConfetti(){
  confetti = [];
  const count = 100;
  for(let i=0;i<count;i++){
    confetti.push({
      x: Math.random()*confettiCanvas.width,
      y: Math.random()*-confettiCanvas.height,
      r: Math.random()*8+4,
      d: Math.random()*60 + 20,
      tilt: Math.random()*10 - 5,
      color: ['#ff8a22','#ffb36b','#ffd9b3'][Math.floor(Math.random()*3)]
    });
  }
  requestAnimationFrame(drawConfetti);
  setTimeout(()=>{ confetti = []; ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height); }, 5000);
}
function drawConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  confetti.forEach((p)=>{
    p.y += Math.cos(p.d) + 3 + p.r/4;
    p.x += Math.sin(p.d) * 0.7;
    p.tilt += 0.05;
    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(p.tilt * 0.2);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r*0.6);
    ctx.restore();
  });
  if(confetti.length) requestAnimationFrame(drawConfetti);
}

/* trigger confetti when final page becomes active */
pages.forEach(p=>{
  p.addEventListener('transitionend', ()=>{
    const pageIndex = Number(p.dataset.idx);
    if(pageIndex === total - 1 && p.classList.contains('active')) triggerConfetti();
  });
});

/* ---------------- page activation / nav ---------------- */
function goTo(i){
  setActive(i);
}
document.getElementById('nextBtn').addEventListener('click', ()=> { next(); });
document.getElementById('prevBtn').addEventListener('click', ()=> { prev(); });

// allow clicking on left area to advance quickly
document.querySelector('.stage-left').addEventListener('click', (e) => {
  const tag = e.target.tagName.toLowerCase();
  if(tag === 'button' || tag === 'input' || tag === 'a') return;
  if(idx < total - 1) next();
});

/* expose render for external use */
window.renderWrapped = render;
window.setActive = setActive;
window.nextSlide = next;
window.prevSlide = prev;

/* ----- small safety: ensure elements exist before binding ----- */
document.getElementById('randomBtn').addEventListener('click', ()=>{}); // noop ensures existence

</script>
</body>
</html>
